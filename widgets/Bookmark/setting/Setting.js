//>>built
require({cache:{"widgets/Bookmark/setting/Edit":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dom-attr dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting esri/geometry/Extent jimu/dijit/ImageChooser jimu/dijit/ExtentChooser jimu/utils dojo/text!./Edit.html".split(" "),function(h,m,k,l,b,p,q,c,r,g,n,f){return h([q,p],{baseClass:"jimu-Bookmark-Edit",ImageChooser:null,templateString:f,extent:{},portalUrl:null,itemId:null,postCreate:function(){this.inherited(arguments);
this.imageChooser=new r({displayImg:this.showImageChooser,goldenWidth:100,goldenHeight:60});this.own(l(this.name,"Change",m.hitch(this,"_onNameChange")));k.addClass(this.imageChooser.domNode,"img-chooser");k.place(this.imageChooser.domNode,this.imageChooserBase,"replace");b.set(this.showImageChooser,"src",this.folderUrl+"images/thumbnail_default.png")},setConfig:function(b){b.name&&this.name.set("value",b.name);if(b.thumbnail){var f=n.processUrlInWidgetConfig(b.thumbnail,this.folderUrl);k.setAttr(this.showImageChooser,
"src",f);this.imageChooser.imageData=f}this.extentChooser=b.extent?new g({portalUrl:this.portalUrl,itemId:this.itemId,initExtent:new c(b.extent)},this.extentChooserNode):new g({portalUrl:this.portalUrl,itemId:this.itemId},this.extentChooserNode);this.own(l(this.extentChooser,"extentChange",m.hitch(this,this._onExtentChange)))},getConfig:function(){return{name:this.name.get("value"),extent:this.extentChooser.getExtent(),thumbnail:this.imageChooser.imageData}},_onNameChange:function(){this._checkRequiredField()},
_onExtentChange:function(b){this.currentExtent=b},_checkRequiredField:function(){this.name.get("value")?this.popup&&this.popup.enableButton(0):this.popup&&this.popup.disableButton(0)}})})},"jimu/dijit/ImageChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/text!./templates/ImageChooser.html dojo/sniff esri/lang ../utils jimu/tokenUtils jimu/dijit/Message".split(" "),function(h,m,k,l,b,p,q,c,r,g,n,f){function t(a,d){a=
a||"";for(var b=0,f=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!g.file.isEnabledFlash(),failure:[a+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){b++;b===f.length&&d()}}],e=0;e<f.length;e++)testLoad(f[e])}var s="unload";return h([m,k],{templateString:q,declaredClass:"jimu.dijit.ImageChooser",displayImg:null,displayCss:null,showSelfImg:!1,selfImg:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.imageChooser;this.nls.readError=
this.nls.readError||"Failed to read the file."},postCreate:function(){this._initial();if(!g.file.supportHTML5()&&!c("safari")&&g.file.isEnabledFlash())if("unload"===s){var a=n.isInBuilderWindow()?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:a+"libs/polyfills/fileAPI/",flashUrl:a+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:a+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};t(a,l.hitch(this,function(){b.setStyle(this.mask,"zIndex",1);s="loaded"}));s="loading"}else b.setStyle(this.mask,
"zIndex",1)},_initial:function(){this._setupPosition();this._porcessMaskClick();this._setupFileInput();this._processTip()},_porcessMaskClick:function(){b.setStyle(this.mask,{position:"absolute",top:0,bottom:0,left:0,right:0,zIndex:10,background:"#000",cursor:"pointer"});this.own(p(this.mask,"click",l.hitch(this,function(a){a.stopPropagation();if(c("safari")&&7>c("safari"))new f({message:this.nls.unsupportReaderAPI});else{if(!g.file.supportHTML5()){if(!g.file.isEnabledFlash()){a=b.create("a",{href:"http://helpx.adobe.com/flash-player.html",
innerHTML:this.nls.enableFlash,target:"_blank"});new f({message:a});return}if(!g.file.supportFileAPI()){new f({message:this.nls.unsupportReaderAPI});return}}this.fileInput.click()}})))},_processTip:function(){var a=r.substitute({width:this.goldenWidth||40,height:this.goldenHeight||40},this.nls.toolTip);b.setAttr(this.domNode,"title",a)},_setupPosition:function(){this.displayClass&&b.addClass(this.domNode,this.displayCss);b.setStyle(this.domNode,{opacity:0,visibility:"visible","float":"left",zIndex:9999,
overflow:"hidden",position:"absolute"});b.setStyle(this.fileInput,{width:"100%",height:"100%",position:"absolute",left:0,top:0,zIndex:9})},_setupFileInput:function(){var a=9>c("ie")?23552:1048576;this.own(p(this.fileInput,"change",l.hitch(this,function(d){g.file.readFile(d,"image/*",a,l.hitch(this,function(d,c,e){d?(e=this.nls[d.errCode],"exceed"===d.errCode&&(e=e.replace("1024",a/1024)),new f({message:e})):(this.onImageChange(e),this.displayImg&&b.setAttr(this.displayImg,"src",e),this.showSelfImg&&
(this.selfImg?b.setAttr(this.selfImg,"src",e):(d=b.getContentBox(this.domNode),this.selfImg=b.create("img",{src:e,style:{position:"absolute",top:0,bottom:0,left:0,right:0,width:d.w+"px",height:d.h+"px",zIndex:8}},this.domNode))))}))})))},onImageChange:function(a){this.imageData=a}})})},"jimu/dijit/ExtentChooser":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/Deferred dijit/_WidgetBase dojo/Evented esri/geometry/Extent jimu/portalUrlUtils jimu/dijit/LoadingShelter jimu/utils".split(" "),
function(h,m,k,l,b,p,q,c,r,g,n){return h([p,q],{baseClass:"jimu-extent-chooser",declaredClass:"jimu.dijit.ExtentChooser",portalUrl:null,itemId:null,initExtent:null,bingMapsKey:"",geometryServiceURL:null,shelter:null,postCreate:function(){this.inherited(arguments);!this.geometryServiceURL&&esriConfig.defaults.geometryService&&(this.geometryServiceURL=esriConfig.defaults.geometryService.url);this.geometryServiceURL||(this.geometryServiceURL=n.getServices().geometryService);this.shelter=new g({hidden:!0});
this.shelter.placeAt(this.domNode);this.shelter.startup();this.shelter.show();var b=k.create("div",{style:{width:"100%",height:"100%"}},this.domNode);if(this.portalUrl&&this.itemId){this.portalUrl=r.getStandardPortalUrl(this.portalUrl);var h={geometryServiceURL:this.geometryServiceURL,bingMapsKey:this.bingMapsKey};this.initExtent&&("esri.geometry.Extent"!==this.initExtent.declaredClass&&(this.initExtent=new c(this.initExtent)),h.mapOptions={extent:this.initExtent});n.createWebMap(this.portalUrl,this.itemId,
b,h).then(m.hitch(this,function(b){this.map=b.map;this.map.webMapResponse=b;this.own(l(this.map,"extent-change",m.hitch(this,function(a){this.onExtentChange(a.extent)})));if(this.initExtent)this.onExtentChange(this.initExtent);else this.onExtentChange(this.map.extent);this.shelter.hide();this.emit("map-load",this.map)}),m.hitch(this,function(b){console.error(b)}))}},getExtent:function(){return this.map&&this.map.extent},setExtent:function(f){if(this.map)return this.map.setExtent(f);var c=new b;setTimeout(m.hitch(this,
function(){c.reject("map is null.")}),0);return c},restoreToDefaultWebMapExtent:function(){n.restoreToDefaultWebMapExtent(this.map,this.map.webMapResponse,this.geometryServiceURL)},onExtentChange:function(b){this.emit("extent-change",b)}})})},"widgets/Bookmark/setting/_build-generate_module":function(){define(["dojo/text!./Setting.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:jimu/dijit/templates/ImageChooser.html":'\x3cdiv class\x3d"jimu-image-chooser js-fileapi-wrapper"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"mask"\x3e\x3c/div\x3e\r\n  \x3cinput type\x3d"file" accept\x3d"image/png, image/jpeg, image/bmp, image/gif" data-dojo-attach-point\x3d"fileInput"\x3e\r\n\x3c/div\x3e',
"url:widgets/Bookmark/setting/Edit.html":'\x3cdiv style\x3d"width: 100%"\x3e\r\n  \x3ctable class\x3d"setting-table input-table" cellspacing\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd title\x3d"${nls.title}" class\x3d"first"\x3e*${nls.title}\x3c/td\x3e\r\n          \x3ctd class\x3d"second"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"name" \r\n            required\x3d"true" placeHolder\x3d${nls.title} data-dojo-props\x3d\'style:{width:"100%"}\'/\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd title\x3d"${nls.thumbnail}" class\x3d"first"\x3e${nls.thumbnail}\x3c/td\x3e\r\n          \x3ctd class\x3d"second"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"imageChooserBase"\x3e\x3c/div\x3e\r\n            \x3cimg class\x3d"thumbnail-img" src\x3d"" data-dojo-attach-point\x3d"showImageChooser"\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;(${nls.thumbnailHint})\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e                                                                  \r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e \r\n    \x3cdiv class\x3d"extent-chooser" style\x3d"height: 400px" data-dojo-attach-point\x3d"extentChooserNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Bookmark/setting/Setting.html":'\x3cdiv\x3e\r\n    \x3cdiv class\x3d"marks-table-div" data-dojo-attach-point\x3d"bookmarksDiv"\x3e\r\n     \x3cdiv class\x3d\'bookmark-add jimu-float-leading\' data-dojo-attach-event\x3d"onclick: onAddBookmarkClick"\x3e\r\n      \x3cdiv class\x3d"add_mark_image"\x3e\x3c/div\x3e\u200b\r\n      \x3cdiv title\x3d"${nls.add}" class\x3d"add_mark_text"\x3e${nls.add}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:widgets/Bookmark/setting/css/style.css":".jimu-img-node{font-size: 12px; position: relative; float: left; border-radius: 4px; color: #686868; overflow: hidden;}.jimu-img-node .node-box{position: absolute; top: 0; bottom: 32px; left: 0; width: 100%; border-radius: 4px; overflow: hidden;}.jimu-img-node img{width: 100%; height: 100%; cursor: pointer;}.jimu-img-node .node-label{position: absolute; width: 100%; left: 0; bottom: 0; height: 30px; text-align: center; overflow: hidden; text-overflow: ellipsis;}.jimu-img-node:hover{color: #51b1fe;}.jimu-img-node.jimu-state-selected .node-label{background-color: #d9dde0;}.jimu-widget-bookmark-setting {height: 100%;}.jimu-widget-bookmark-setting .bookmark-list{height: 100%; width: 100%; overflow: auto;}.jimu-widget-bookmark-setting .marks-table-div{width: 100%; height: 100%; overflow-x:hidden; overflow-y:auto;}.jimu-widget-bookmark-setting .bookmark-add{position:relative; width:100px; height:60px; padding:3px; text-align:center; color:#999999; font-size:10px; border:1px dotted gray; -webkit-border-radius:5px; -moz-border-radius:5px; -o-border-radius:5px; -ms-border-radius:5px; border-radius:5px; background-size:cover; margin-top: 5px; margin-left: 20px\\9;}.jimu-widget-bookmark-setting .bookmark-add .add_mark_image{display: block; position: absolute; left: 43px; top: 5px; width:14px; height:14px; background-position:center center; background-image:url(images/add_mark.png);}.jimu-widget-bookmark-setting .bookmark-add .add_mark_text{display: block; position: absolute; top: 25px; width: 100%; font-size: 12px; white-space: normal; height: 28px; overflow: hidden; text-overflow: ellipsis;}.jimu-widget-bookmark-setting .bookmark-add:hover{cursor: pointer;}.jimu-widget-bookmark-setting .mark-item-div{position:relative; width:100px; height: 92px; font-size: 10px; margin-top: 5px;}.jimu-widget-bookmark-setting .mark-item-div:nth-child(8n+1){margin-left: 0px;}.jimu-widget-bookmark-setting .mark-item-div .mark-item-bg{position:relative; width:100%; height:60px; line-height:28px; text-align:center; color:#999999; font-size:13px;}.jimu-widget-bookmark-setting .mark-item-div .mark-item-bg .mark-item-thumbnail{width:100%; height:100%; -webkit-border-radius:5px; -moz-border-radius:5px; -o-border-radius:5px; -ms-border-radius:5px; border-radius:5px;}.jimu-widget-bookmark-setting .mark-item-div .mark-item-detail-icon{display: block;}.jimu-widget-bookmark-setting .mark-item-div .mark-item-bg.selected .mark-item-thumbnail{-webkit-box-sizing:content-box; -moz-box-sizing:content-box; -ms-box-sizing:content-box; -o-box-sizing:content-box; box-sizing:content-box;}.jimu-widget-bookmark-setting .mark-item-div .mark-item-bg .mark-item-detail-icon{display: none; position:absolute; right:2px; bottom:2px; width:20px; height:20px; background-color:rgba(0, 0, 0, 0.3); background-repeat:no-repeat; background-position:center center; background-image:url(images/edit_mark.png); -webkit-border-radius:3px; -moz-border-radius:3px; -o-border-radius:3px; -ms-border-radius:3px; border-radius:3px; cursor:pointer;}.jimu-widget-bookmark-setting .mark-item-div .mark-item-bg .mark-item-detail-icon:hover{background-color:rgba(0, 0, 0, 0.6);}.jimu-widget-bookmark-setting .mark-item-div .mark-item-bg:hover .mark-item-detail-icon{display: block;}.jimu-widget-bookmark-setting .mark-item-div .mark-item-bg .mark-item-delete-icon{display: none; position:absolute; right:5px; top:5px; width:10px; height:10px; background-repeat:no-repeat; background-position:center center; background-image:url(images/delete_mark.png); -webkit-border-radius:3px; -moz-border-radius:3px; -o-border-radius:3px; -ms-border-radius:3px; border-radius:3px; cursor:pointer;}.jimu-widget-bookmark-setting .mark-item-div .mark-item-bg:hover .mark-item-delete-icon{display: block;}.jimu-widget-bookmark-setting .mark-item-div .mark-item-title{display:inline-block; width:100%; text-align:center; color:#333333; font-size:12px; margin-top: 2px; margin-bottom: 25px; overflow: hidden; text-overflow: ellipsis; height: 30px;}.jimu-Bookmark-Edit{height: 100%; overflow-y: auto;}.jimu-Bookmark-Edit .setting-table {margin: 5px 20px; border-spacing: 10px; border-collapse: separate;}.jimu-Bookmark-Edit .setting-table .thumbnail-img{width: 100px; height: 60px;}.jimu-Bookmark-Edit .setting-table .img-chooser{width: 100px; height: 60px;}.jimu-Bookmark-Edit .input-table \x3e tbody \x3e tr \x3e .first{width:auto; text-align: left; padding-right:15px; white-space: nowrap; max-width: 108px; overflow: hidden; text-overflow: ellipsis;}.jimu-Bookmark-Edit .input-table \x3e tbody \x3e tr \x3e .second{width:660px;}.jimu-rtl .jimu-widget-bookmark-setting .mark-item-div .mark-item-bg .mark-item-delete-icon{right:auto; left: 5px;}.jimu-rtl .jimu-widget-bookmark-setting .mark-item-div .mark-item-bg .mark-item-detail-icon{right:auto; left: 2px;}.jimu-rtl .jimu-widget-bookmark-setting .mark-item-div:nth-child(8n+1){margin-left: auto; margin-right: 0px;}.jimu-rtl .jimu-widget-bookmark-setting .bookmark-add{margin-left: auto; margin-right: 20px\\9;}",
"*now":function(h){h(['dojo/i18n!*preload*widgets/Bookmark/setting/nls/Setting*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","ROOT"]'])}}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/keys dojo/query jimu/BaseWidgetSetting jimu/dijit/Popup jimu/dijit/Message jimu/utils ./Edit libs/storejs/store".split(" "),function(h,m,k,l,b,p,q,c,r,g,n,f,t,s){return h([r,m],{baseClass:"jimu-widget-bookmark-setting",bookmarks:[],edit:null,popup:null,popupState:"",editIndex:null,startup:function(){this.inherited(arguments);this.setConfig(this.config)},setConfig:function(a){this.config=
a;this.bookmarks=this.config.bookmarks2D;this.map.itemInfo&&(this.map.itemInfo.itemData&&this.map.itemInfo.itemData.bookmarks)&&l.forEach(this.map.itemInfo.itemData.bookmarks,function(a){a.isInWebmap=!0;a.name=a.name;for(var b=0,c=0;c<this.bookmarks.length;c++)this.bookmarks[c].name===a.name&&b++;b||this.bookmarks.push(a)},this);this.currentBookmark=null;this.displayBookmarks()},getConfig:function(a){this.config.bookmarks2D=this.bookmarks;if(a){a=this._getKeysKey();for(var b in s.getAll())b.startWith(a)&&
s.remove(b)}return this.config},displayBookmarks:function(){this._clearBookmarksDiv();this._createmarkItems()},_clearBookmarksDiv:function(){for(var a=c(".mark-item-div",this.domNode),d=0;d<a.length;d++)b.destroy(a[d])},destroy:function(){this.inherited(arguments)},_getKeysKey:function(){return this.appConfig.map["3D"]?this.name+".3D":this.name+".2D"},onAddBookmarkClick:function(){this.popupState="ADD";this._openEdit(this.nls.addBookmark,{name:"",thumbnail:"",extent:this.map.extent.toJson()})},getBookmarkByName:function(a){for(var b=
this.bookmarks.length,c=0;c<b;c++)if(this.bookmarks[c].name===a)return this.editIndex=c,this.bookmarks[c]},_onEditClick:function(a){this.getBookmarkByName(a);a=this.bookmarks[this.editIndex];this.popupState="EDIT";this._openEdit(this.nls.edit,a)},_openEdit:function(a,d){this.edit=new t({nls:this.nls,folderUrl:this.folderUrl,portalUrl:this.appConfig.map.portalUrl,itemId:this.appConfig.map.itemId});this.edit.setConfig(d||{});this.popup=new g({titleLabel:a,autoHeight:!0,content:this.edit,container:"main-page",
width:640,buttons:[{label:this.nls.ok,key:q.ENTER,disable:!0,onClick:k.hitch(this,"_onEditOk")},{label:this.nls.cancel,key:q.ESCAPE}],onClose:k.hitch(this,"_onEditClose")});b.addClass(this.popup.domNode,"widget-setting-popup");this.edit.startup()},_onEditOk:function(){var a=this.edit.getConfig(),b=null;!a.name||!a.extent?new n({message:this.nls.warning}):("ADD"===this.popupState?(this.bookmarks.push(a),this.displayBookmarks(),b=!0):"EDIT"===this.popupState&&(this.bookmarks.splice(this.editIndex,1,
a),this.displayBookmarks(),b=!0),b?(this.popup.close(),this.popupState="",this.editIndex=null,b=!1):(a=l.mark(b.repeatFields,k.hitch(this,function(a){return a&&a.name})),new n({message:this.nls[b.errorCode]+a.toString()})))},_onEditClose:function(){this.popup=this.edit=null},_createmarkItems:function(){for(var a=0;a<this.bookmarks.length;a++){var c=this._createmarkItem(this.bookmarks[a]);b.place(c,this.bookmarksDiv)}},_createmarkItem:function(a){var d=b.toDom("\x3cdiv class\x3d'mark-item-div jimu-float-leading jimu-leading-margin2'\x3e\x3cdiv class\x3d'mark-item-bg'\x3e\x3cimg class\x3d'mark-item-thumbnail'\x3e\x3cdiv class\x3d'mark-item-delete-icon'\x3e\x3c/div\x3e\x3cdiv class\x3d'mark-item-detail-icon'\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan class\x3d'mark-item-title'\x3e\x3c/span\x3e\x3c/div\x3e"),
g=c(".mark-item-thumbnail",d)[0],h=c(".mark-item-title",d)[0],e=c(".mark-item-delete-icon",d)[0];this.own(p(e,"click",k.hitch(this,this._onmarkItemDeleteClick,a.name)));e=c(".mark-item-detail-icon",d)[0];this.own(p(e,"click",k.hitch(this,this._onmarkItemEditClick,a.name)));d.item=a;e=a.thumbnail?f.processUrlInWidgetConfig(a.thumbnail,this.folderUrl):this.folderUrl+"images/thumbnail_default.png";b.setAttr(g,"src",e);h.innerHTML=a.name;b.setAttr(h,"title",a.name);return d},_clearBasemarksDiv:function(){for(var a=
c(".mark-item-div",this.domNode),d=0;d<a.length;d++)b.destroy(a[d])},_onmarkItemEditClick:function(a){this._onEditClick(a)},_onmarkItemDeleteClick:function(a){this.getBookmarkByName(a);null!==this.editIndex&&this.bookmarks.splice(this.editIndex,1);this.displayBookmarks()}})});