//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),function(f,k,l,p,h,m){return f(null,{queryUrl:"",idProperty:"id",data:null,_entityData:null,constructor:function(a){f.safeMixin(this,a);this.data=[];this._entityData=[];this.layer=a.layer;this.objectIds=a.objectIds;this.where=a.where;this.orderByFields=a.orderByFields;this.totalCount=a.totalCount;this.batchCount=a.batchCount||25;this.idProperty=this.layer.objectIdField;
this.layer&&this.layer.url&&(this.queryTask=new h(this.layer.url))},get:function(a){return this.data[a]},getIdentity:function(a){return a[this.idProperty]},query:function(a,f){var e=new p,d=f&&f.start||0,n=this.batchCount;if(this.objectIds){var g=null,g="function"===typeof a?l.filter(this.objectIds,k.hitch(this,function(c){return a(c)})):this.objectIds;e.objectIds=g.length>=d+this.batchCount?g.slice(d,d+n):g.slice(d)}else e.start=d,e.num=n,e.where=this.where,e.orderByFields=this.orderByFields;e.returnGeometry=
!1;e.outFields=["*"];var h=this.totalCount,d=null,d=!e.where;if(!(e.objectIds&&0<e.objectIds.length)&&d)return new m([]);d=this.queryTask?this.queryTask.execute(e):this.layer.queryFeatures(e);d.total=d.then(k.hitch(this,function(c){var b=0,a=this.layer.objectIdField;if(this.objectIds){if(!a)for(b=0;b<c.fields.length;b++)if("esriFieldTypeOID"===c.fields[b].type){a=c.fields[b].name;break}for(var d={},b=0;b<c.features.length;b++)d[c.features[b].attributes[a]]=c.features[b];c.features=l.map(e.objectIds,
function(a){return d[a]})}for(b=0;b<c.features.length;b++)c.features[b]&&(c.features[b]=c.features[b].attributes,this.data[c.features[b][a]]=c.features[b],this._entityData.push(c.features[b]));c=c.features;return h}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");return 0});return new m(d)}})});