//>>built
require({cache:{"dijit/layout/TabContainer":function(){define(["dojo/_base/lang","dojo/_base/declare","./_TabContainerBase","./TabController","./ScrollingTabController"],function(g,c,m,s,f){return c("dijit.layout.TabContainer",m,{useMenu:!0,useSlider:!0,controllerWidget:"",_makeController:function(c){var f=this.baseClass+"-tabs"+(this.doLayout?"":" dijitTabNoLayout");return new ("string"==typeof this.controllerWidget?g.getObject(this.controllerWidget):this.controllerWidget)({id:this.id+"_tablist",
ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,tabPosition:this.tabPosition,doLayout:this.doLayout,containerId:this.id,"class":f,nested:this.nested,useMenu:this.useMenu,useSlider:this.useSlider,tabStripClass:this.tabStrip?this.baseClass+(this.tabStrip?"":"No")+"Strip":null},c)},postMixInProperties:function(){this.inherited(arguments);this.controllerWidget||(this.controllerWidget=("top"==this.tabPosition||"bottom"==this.tabPosition)&&!this.nested?f:s)}})})},"dijit/layout/_TabContainerBase":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style ./StackContainer ./utils ../registry ../_TemplatedMixin dojo/text!./templates/TabContainer.html".split(" "),
function(g,c,m,s,f,k,n,b,d){return g("dijit.layout._TabContainerBase",[f,b],{tabPosition:"top",baseClass:"dijitTabContainer",tabStrip:!1,nested:!1,templateString:d,postMixInProperties:function(){this.baseClass+=this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"");this.srcNodeRef&&s.set(this.srcNodeRef,"visibility","hidden");this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.tablist=this._makeController(this.tablistNode);this.doLayout||
c.add(this.domNode,"dijitTabContainerNoLayout");this.nested?(c.add(this.domNode,"dijitTabContainerNested"),c.add(this.tablist.containerNode,"dijitTabContainerTabListNested"),c.add(this.tablistSpacer,"dijitTabContainerSpacerNested"),c.add(this.containerNode,"dijitTabPaneWrapperNested")):c.add(this.domNode,"tabStrip-"+(this.tabStrip?"enabled":"disabled"))},_setupChild:function(b){c.add(b.domNode,"dijitTabPane");this.inherited(arguments)},startup:function(){this._started||(this.tablist.startup(),this.inherited(arguments))},
layout:function(){if(this._contentBox&&"undefined"!=typeof this._contentBox.l){var b=this.selectedChildWidget;if(this.doLayout){var d=this.tabPosition.replace(/-h/,"");this.tablist.region=d;d=[this.tablist,{domNode:this.tablistSpacer,region:d},{domNode:this.containerNode,region:"center"}];k.layoutChildren(this.domNode,this._contentBox,d);this._containerContentBox=k.marginBox2contentBox(this.containerNode,d[2]);b&&b.resize&&b.resize(this._containerContentBox)}else{if(this.tablist.resize){d=this.tablist.domNode.style;
d.width="0";var p=m.getContentBox(this.domNode).w;d.width="";this.tablist.resize({w:p})}b&&b.resize&&b.resize()}}},destroy:function(b){this.tablist&&this.tablist.destroy(b);this.inherited(arguments)},selectChild:function(b,d){this._focused&&(b=n.byId(b),this.tablist.pane2button(b.id).focus());return this.inherited(arguments)}})})},"dijit/layout/StackContainer":function(){define("dojo/_base/array dojo/cookie dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/ready dojo/topic dojo/when ../registry ../_WidgetBase ./_LayoutWidget".split(" "),
function(g,c,m,s,f,k,n,b,d,t,u,p,w,x){k("dijit-legacy-requires")&&d(0,function(){require(["dijit/layout/StackController"])});m=m("dijit.layout.StackContainer",x,{doLayout:!0,persist:!1,baseClass:"dijitStackContainer",buildRendering:function(){this.inherited(arguments);s.add(this.domNode,"dijitLayoutContainer")},postCreate:function(){this.inherited(arguments);this.own(b(this.domNode,"keydown",n.hitch(this,"_onKeyDown")))},startup:function(){if(!this._started){var a=this.getChildren();g.forEach(a,this._setupChild,
this);this.persist?this.selectedChildWidget=p.byId(c(this.id+"_selectedChild")):g.some(a,function(a){a.selected&&(this.selectedChildWidget=a);return a.selected},this);var e=this.selectedChildWidget;!e&&a[0]&&(e=this.selectedChildWidget=a[0],e.selected=!0);t.publish(this.id+"-startup",{children:a,selected:e,textDir:this.textDir});this.inherited(arguments)}},resize:function(){if(!this._hasBeenShown){this._hasBeenShown=!0;var a=this.selectedChildWidget;a&&this._showChild(a)}this.inherited(arguments)},
_setupChild:function(a){var e=a.domNode,q=f.place("\x3cdiv role\x3d'tabpanel' class\x3d'"+this.baseClass+"ChildWrapper dijitHidden'\x3e",a.domNode,"replace"),b=a["aria-label"]||a.title||a.label;b&&q.setAttribute("aria-label",b);f.place(e,q);a._wrapper=q;this.inherited(arguments);"none"==e.style.display&&(e.style.display="block");a.domNode.removeAttribute("title")},addChild:function(a,e){this.inherited(arguments);this._started&&(t.publish(this.id+"-addChild",a,e),this.layout(),this.selectedChildWidget||
this.selectChild(a))},removeChild:function(a){var e=g.indexOf(this.getChildren(),a);this.inherited(arguments);f.destroy(a._wrapper);delete a._wrapper;this._started&&t.publish(this.id+"-removeChild",a);if(!this._descendantsBeingDestroyed){if(this.selectedChildWidget===a&&(this.selectedChildWidget=void 0,this._started)){var q=this.getChildren();q.length&&this.selectChild(q[Math.max(e-1,0)])}this._started&&this.layout()}},selectChild:function(a,e){var q;a=p.byId(a);this.selectedChildWidget!=a&&(q=this._transition(a,
this.selectedChildWidget,e),this._set("selectedChildWidget",a),t.publish(this.id+"-selectChild",a),this.persist&&c(this.id+"_selectedChild",this.selectedChildWidget.id));return u(q||!0)},_transition:function(a,e){e&&this._hideChild(e);var q=this._showChild(a);a.resize&&(this.doLayout?a.resize(this._containerContentBox||this._contentBox):a.resize());return q},_adjacent:function(a){var e=this.getChildren(),q=g.indexOf(e,this.selectedChildWidget),q=q+(a?1:e.length-1);return e[q%e.length]},forward:function(){return this.selectChild(this._adjacent(!0),
!0)},back:function(){return this.selectChild(this._adjacent(!1),!0)},_onKeyDown:function(a){t.publish(this.id+"-containerKeyDown",{e:a,page:this})},layout:function(){var a=this.selectedChildWidget;a&&a.resize&&(this.doLayout?a.resize(this._containerContentBox||this._contentBox):a.resize())},_showChild:function(a){var e=this.getChildren();a.isFirstChild=a==e[0];a.isLastChild=a==e[e.length-1];a._set("selected",!0);a._wrapper&&s.replace(a._wrapper,"dijitVisible","dijitHidden");return a._onShow&&a._onShow()||
!0},_hideChild:function(a){a._set("selected",!1);a._wrapper&&s.replace(a._wrapper,"dijitHidden","dijitVisible");a.onHide&&a.onHide()},closeChild:function(a){a.onClose&&a.onClose(this,a)&&(this.removeChild(a),a.destroyRecursive())},destroyDescendants:function(a){this._descendantsBeingDestroyed=!0;this.selectedChildWidget=void 0;g.forEach(this.getChildren(),function(e){a||this.removeChild(e);e.destroyRecursive(a)},this);this._descendantsBeingDestroyed=!1}});m.ChildWidgetProperties={selected:!1,disabled:!1,
closable:!1,iconClass:"dijitNoIcon",showTitle:!0};n.extend(w,m.ChildWidgetProperties);return m})},"dijit/layout/TabController":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/has dojo/i18n dojo/_base/lang ./StackController ../registry ../Menu ../MenuItem dojo/text!./templates/_TabButton.html dojo/i18n!../nls/common".split(" "),function(g,c,m,s,f,k,n,b,d,t,u,p){p=g("dijit.layout._TabButton"+(f("dojo-bidi")?"_NoBidi":""),b.StackButton,{baseClass:"dijitTab",cssStateNodes:{closeNode:"dijitTabCloseButton"},
templateString:p,_setNameAttr:"focusNode",scrollOnFocus:!1,buildRendering:function(){this.inherited(arguments);c.setSelectable(this.containerNode,!1)},startup:function(){this.inherited(arguments);var b=this.domNode;this.defer(function(){b.className=b.className},1)},_setCloseButtonAttr:function(b){this._set("closeButton",b);s.toggle(this.domNode,"dijitClosable",b);this.closeNode.style.display=b?"":"none";b&&(b=k.getLocalization("dijit","common"),this.closeNode&&m.set(this.closeNode,"title",b.itemClose))},
_setDisabledAttr:function(b){this.inherited(arguments);if(this.closeNode)if(b)m.remove(this.closeNode,"title");else{var p=k.getLocalization("dijit","common");m.set(this.closeNode,"title",p.itemClose)}},_setLabelAttr:function(b){this.inherited(arguments);!this.showLabel&&!this.params.title&&(this.iconNode.alt=n.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});f("dojo-bidi")&&(p=g("dijit.layout._TabButton",p,{_setLabelAttr:function(b){this.inherited(arguments);this.applyTextDir(this.iconNode,
this.iconNode.alt)}}));g=g("dijit.layout.TabController",b,{baseClass:"dijitTabController",templateString:"\x3cdiv role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown:onkeydown'\x3e\x3c/div\x3e",tabPosition:"top",buttonWidget:p,buttonWidgetCloseClass:"dijitTabCloseButton",postCreate:function(){this.inherited(arguments);var b=new t({id:this.id+"_Menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,targetNodeIds:[this.domNode],selector:function(a){return s.contains(a,
"dijitClosable")&&!s.contains(a,"dijitTabDisabled")}});this.own(b);var p=k.getLocalization("dijit","common"),a=this;b.addChild(new u({label:p.itemClose,ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,onClick:function(e){e=d.byNode(this.getParent().currentTarget);a.onCloseButtonClick(e.page)}}))}});g.TabButton=p;return g})},"dijit/layout/StackController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/topic ../focus ../registry ../_Widget ../_TemplatedMixin ../_Container ../form/ToggleButton dojo/touch".split(" "),
function(g,c,m,s,f,k,n,b,d,t,u,p,w,x){s=c("dijit.layout._StackButton",x,{tabIndex:"-1",closeButton:!1,_aria_attr:"aria-selected",buildRendering:function(a){this.inherited(arguments);(this.focusNode||this.domNode).setAttribute("role","tab")}});c=c("dijit.layout.StackController",[u,p,w],{baseClass:"dijitStackController",templateString:"\x3cspan role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown'\x3e\x3c/span\x3e",containerId:"",buttonWidget:s,buttonWidgetCloseClass:"dijitStackCloseButton",pane2button:function(a){return t.byId(this.id+
"_"+a)},postCreate:function(){this.inherited(arguments);this.own(b.subscribe(this.containerId+"-startup",k.hitch(this,"onStartup")),b.subscribe(this.containerId+"-addChild",k.hitch(this,"onAddChild")),b.subscribe(this.containerId+"-removeChild",k.hitch(this,"onRemoveChild")),b.subscribe(this.containerId+"-selectChild",k.hitch(this,"onSelectChild")),b.subscribe(this.containerId+"-containerKeyDown",k.hitch(this,"onContainerKeyDown")));this.containerNode.dojoClick=!0;this.own(n(this.containerNode,"click",
k.hitch(this,function(a){var e=t.getEnclosingWidget(a.target);if(e!=this.containerNode&&!e.disabled&&e.page)for(a=a.target;a!==this.containerNode;a=a.parentNode)if(m.contains(a,this.buttonWidgetCloseClass)){this.onCloseButtonClick(e.page);break}else if(a==e.domNode){this.onButtonClick(e.page);break}})))},onStartup:function(a){this.textDir=a.textDir;g.forEach(a.children,this.onAddChild,this);if(a.selected)this.onSelectChild(a.selected);var e=t.byId(this.containerId).containerNode,b=k.hitch(this,"pane2button");
a={title:"label",showtitle:"showLabel",iconclass:"iconClass",closable:"closeButton",tooltip:"title",disabled:"disabled",textdir:"textdir"};var p=function(a,p){return n(e,"attrmodified-"+a,function(a){var e=b(a.detail&&a.detail.widget&&a.detail.widget.id);e&&e.set(p,a.detail.newValue)})},d;for(d in a)this.own(p(d,a[d]))},destroy:function(a){this.destroyDescendants(a);this.inherited(arguments)},onAddChild:function(a,e){var b=new (k.isString(this.buttonWidget)?k.getObject(this.buttonWidget):this.buttonWidget)({id:this.id+
"_"+a.id,name:this.id+"_"+a.id,label:a.title,disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||this.textDir,showLabel:a.showTitle,iconClass:a.iconClass,closeButton:a.closable,title:a.tooltip,page:a});this.addChild(b,e);a.controlButton=b;if(!this._currentChild)this.onSelectChild(a);b=a._wrapper.getAttribute("aria-labelledby")?a._wrapper.getAttribute("aria-labelledby")+" "+b.id:b.id;a._wrapper.removeAttribute("aria-label");a._wrapper.setAttribute("aria-labelledby",
b)},onRemoveChild:function(a){this._currentChild===a&&(this._currentChild=null);var e=this.pane2button(a.id);e&&(this.removeChild(e),e.destroy());delete a.controlButton},onSelectChild:function(a){if(a){if(this._currentChild){var e=this.pane2button(this._currentChild.id);e.set("checked",!1);e.focusNode.setAttribute("tabIndex","-1")}e=this.pane2button(a.id);e.set("checked",!0);this._currentChild=a;e.focusNode.setAttribute("tabIndex","0");t.byId(this.containerId)}},onButtonClick:function(a){var e=this.pane2button(a.id);
d.focus(e.focusNode);this._currentChild&&this._currentChild.id===a.id&&e.set("checked",!0);t.byId(this.containerId).selectChild(a)},onCloseButtonClick:function(a){t.byId(this.containerId).closeChild(a);this._currentChild&&(a=this.pane2button(this._currentChild.id))&&d.focus(a.focusNode||a.domNode)},adjacent:function(a){if(!this.isLeftToRight()&&(!this.tabPosition||/top|bottom/.test(this.tabPosition)))a=!a;var e=this.getChildren(),b=g.indexOf(e,this.pane2button(this._currentChild.id)),p=e[b],d;do b=
(b+(a?1:e.length-1))%e.length,d=e[b];while(d.disabled&&d!=p);return d},onkeydown:function(a,e){if(!this.disabled&&!a.altKey){var b=null;if(a.ctrlKey||!a._djpage){switch(a.keyCode){case f.LEFT_ARROW:case f.UP_ARROW:a._djpage||(b=!1);break;case f.PAGE_UP:a.ctrlKey&&(b=!1);break;case f.RIGHT_ARROW:case f.DOWN_ARROW:a._djpage||(b=!0);break;case f.PAGE_DOWN:a.ctrlKey&&(b=!0);break;case f.HOME:for(var p=this.getChildren(),d=0;d<p.length;d++){var c=p[d];if(!c.disabled){this.onButtonClick(c.page);break}}a.stopPropagation();
a.preventDefault();break;case f.END:p=this.getChildren();for(d=p.length-1;0<=d;d--)if(c=p[d],!c.disabled){this.onButtonClick(c.page);break}a.stopPropagation();a.preventDefault();break;case f.DELETE:case 87:if(this._currentChild.closable&&(a.keyCode==f.DELETE||a.ctrlKey))this.onCloseButtonClick(this._currentChild),a.stopPropagation(),a.preventDefault();break;case f.TAB:a.ctrlKey&&(this.onButtonClick(this.adjacent(!a.shiftKey).page),a.stopPropagation(),a.preventDefault())}null!==b&&(this.onButtonClick(this.adjacent(b).page),
a.stopPropagation(),a.preventDefault())}}},onContainerKeyDown:function(a){a.e._djpage=a.page;this.onkeydown(a.e)}});c.StackButton=s;return c})},"dijit/layout/ScrollingTabController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/_base/lang dojo/on dojo/query dojo/sniff ../registry dojo/text!./templates/ScrollingTabController.html dojo/text!./templates/_ScrollingTabControllerButton.html ./TabController ./utils ../_WidgetsInTemplateMixin ../Menu ../MenuItem ../form/Button ../_HasDropDown dojo/NodeList-dom ../a11yclick".split(" "),
function(g,c,m,s,f,k,n,b,d,t,u,p,w,x,a,e,q,I,A,B){p=c("dijit.layout.ScrollingTabController",[x,e],{baseClass:"dijitTabController dijitScrollingTabController",templateString:p,useMenu:!0,useSlider:!0,tabStripClass:"",_minScroll:5,_setClassAttr:{node:"containerNode",type:"class"},buildRendering:function(){this.inherited(arguments);var a=this.domNode;this.scrollNode=this.tablistWrapper;this._initButtons();this.tabStripClass||(this.tabStripClass="dijitTabContainer"+this.tabPosition.charAt(0).toUpperCase()+
this.tabPosition.substr(1).replace(/-.*/,"")+"None",m.add(a,"tabStrip-disabled"));m.add(this.tablistWrapper,this.tabStripClass)},onStartup:function(){this.inherited(arguments);f.set(this.domNode,"visibility","");this._postStartup=!0;this.own(b(this.containerNode,"attrmodified-label, attrmodified-iconclass",n.hitch(this,function(a){this._dim&&this.resize(this._dim)})))},onAddChild:function(a,e){this.inherited(arguments);f.set(this.containerNode,"width",f.get(this.containerNode,"width")+200+"px")},
onRemoveChild:function(a,e){var b=this.pane2button(a.id);this._selectedTab===b.domNode&&(this._selectedTab=null);this.inherited(arguments)},_initButtons:function(){this._btnWidth=0;this._buttons=d("\x3e .tabStripButton",this.domNode).filter(function(a){if(this.useMenu&&a==this._menuBtn.domNode||this.useSlider&&(a==this._rightBtn.domNode||a==this._leftBtn.domNode))return this._btnWidth+=s.getMarginSize(a).w,!0;f.set(a,"display","none");return!1},this)},_getTabsWidth:function(){var a=this.getChildren();
if(a.length){var e=a[this.isLeftToRight()?0:a.length-1].domNode,a=a[this.isLeftToRight()?a.length-1:0].domNode;return a.offsetLeft+a.offsetWidth-e.offsetLeft}return 0},_enableBtn:function(a){var e=this._getTabsWidth();a=a||f.get(this.scrollNode,"width");return 0<e&&a<e},resize:function(e){this._dim=e;this.scrollNode.style.height="auto";var b=this._contentBox=a.marginBox2contentBox(this.domNode,{h:0,w:e.w});b.h=this.scrollNode.offsetHeight;s.setContentSize(this.domNode,b);b=this._enableBtn(this._contentBox.w);
this._buttons.style("display",b?"":"none");this._leftBtn.region="left";this._rightBtn.region="right";this._menuBtn.region=this.isLeftToRight()?"right":"left";a.layoutChildren(this.domNode,this._contentBox,[this._menuBtn,this._leftBtn,this._rightBtn,{domNode:this.scrollNode,region:"center"}]);this._selectedTab&&(this._anim&&"playing"==this._anim.status()&&this._anim.stop(),this.scrollNode.scrollLeft=this._convertToScrollLeft(this._getScrollForSelectedTab()));this._setButtonClass(this._getScroll());
this._postResize=!0;return{h:this._contentBox.h,w:e.w}},_getScroll:function(){return this.isLeftToRight()||8>t("ie")||t("ie")&&t("quirks")||t("webkit")?this.scrollNode.scrollLeft:f.get(this.containerNode,"width")-f.get(this.scrollNode,"width")+(8<=t("ie")?-1:1)*this.scrollNode.scrollLeft},_convertToScrollLeft:function(a){if(this.isLeftToRight()||8>t("ie")||t("ie")&&t("quirks")||t("webkit"))return a;var e=f.get(this.containerNode,"width")-f.get(this.scrollNode,"width");return(8<=t("ie")?-1:1)*(a-e)},
onSelectChild:function(a){var e=this.pane2button(a.id);if(e){e=e.domNode;if(e!=this._selectedTab&&(this._selectedTab=e,this._postResize)){var b=this._getScroll();(b>e.offsetLeft||b+f.get(this.scrollNode,"width")<e.offsetLeft+f.get(e,"width"))&&this.createSmoothScroll().play()}this.inherited(arguments)}},_getScrollBounds:function(){var a=this.getChildren(),e=f.get(this.scrollNode,"width"),b=f.get(this.containerNode,"width")-e,p=this._getTabsWidth();if(a.length&&p>e)return{min:this.isLeftToRight()?
0:a[a.length-1].domNode.offsetLeft,max:this.isLeftToRight()?a[a.length-1].domNode.offsetLeft+a[a.length-1].domNode.offsetWidth-e:b};a=this.isLeftToRight()?0:b;return{min:a,max:a}},_getScrollForSelectedTab:function(){var a=this._selectedTab,e=f.get(this.scrollNode,"width"),b=this._getScrollBounds(),a=a.offsetLeft+f.get(a,"width")/2-e/2;return a=Math.min(Math.max(a,b.min),b.max)},createSmoothScroll:function(a){if(0<arguments.length){var e=this._getScrollBounds();a=Math.min(Math.max(a,e.min),e.max)}else a=
this._getScrollForSelectedTab();this._anim&&"playing"==this._anim.status()&&this._anim.stop();var b=this,p=this.scrollNode,d=new k.Animation({beforeBegin:function(){this.curve&&delete this.curve;var e=p.scrollLeft,q=b._convertToScrollLeft(a);d.curve=new k._Line(e,q)},onAnimate:function(a){p.scrollLeft=a}});this._anim=d;this._setButtonClass(a);return d},_getBtnNode:function(a){for(a=a.target;a&&!m.contains(a,"tabStripButton");)a=a.parentNode;return a},doSlideRight:function(a){this.doSlide(1,this._getBtnNode(a))},
doSlideLeft:function(a){this.doSlide(-1,this._getBtnNode(a))},doSlide:function(a,e){if(!e||!m.contains(e,"dijitTabDisabled")){var b=0.75*f.get(this.scrollNode,"width")*a,b=this._getScroll()+b;this._setButtonClass(b);this.createSmoothScroll(b).play()}},_setButtonClass:function(a){var e=this._getScrollBounds();this._leftBtn.set("disabled",a<=e.min);this._rightBtn.set("disabled",a>=e.max)}});w=c("dijit.layout._ScrollingTabControllerButtonMixin",null,{baseClass:"dijitTab tabStripButton",templateString:w,
tabIndex:"",isFocusable:function(){return!1}});c("dijit.layout._ScrollingTabControllerButton",[A,w]);c("dijit.layout._ScrollingTabControllerMenuButton",[A,B,w],{containerId:"",tabIndex:"-1",isLoaded:function(){return!1},loadDropDown:function(a){this.dropDown=new q({id:this.containerId+"_menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir});var e=u.byId(this.containerId);g.forEach(e.getChildren(),function(a){var b=new I({id:a.id+"_stcMi",label:a.title,iconClass:a.iconClass,
disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||e.textDir,onClick:function(){e.selectChild(a)}});this.dropDown.addChild(b)},this);a()},closeDropDown:function(a){this.inherited(arguments);this.dropDown&&(this._popupStateNode.removeAttribute("aria-owns"),this.dropDown.destroyRecursive(),delete this.dropDown)}});return p})},"dojo/store/Cache":function(){define(["../_base/lang","../when"],function(g,c){var m=function(m,f,k){k=k||{};return g.delegate(m,{query:function(c,
b){var d=m.query(c,b);d.forEach(function(b){(!k.isLoaded||k.isLoaded(b))&&f.put(b)});return d},queryEngine:m.queryEngine||f.queryEngine,get:function(n,b){return c(f.get(n),function(d){return d||c(m.get(n,b),function(b){b&&f.put(b,{id:n});return b})})},add:function(n,b){return c(m.add(n,b),function(d){f.add(d&&"object"==typeof d?d:n,b);return d})},put:function(n,b){f.remove(b&&b.id||this.getIdentity(n));return c(m.put(n,b),function(d){f.put(d&&"object"==typeof d?d:n,b);return d})},remove:function(n,
b){return c(m.remove(n,b),function(d){return f.remove(n,b)})},evict:function(c){return f.remove(c)}})};g.setObject("dojo.store.Cache",m);return m})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(g,c,m,s){g=function(f){function g(b,p){var d=f[b];d&&(f[b]=function(c){var a;"put"===b&&(a=f.getIdentity(c));if(t)return d.apply(this,arguments);t=!0;try{var e=d.apply(this,arguments);m(e,function(e){p("object"==typeof e&&e||c,a)});return e}finally{t=
!1}})}var n=[],b=0;f=c.delegate(f);f.notify=function(d,p){b++;for(var c=n.slice(),f=0,a=c.length;f<a;f++)c[f](d,p)};var d=f.query;f.query=function(t,p){p=p||{};var g=d.apply(this,arguments);if(g&&g.forEach){var x=c.mixin({},p);delete x.start;delete x.count;var a=f.queryEngine&&f.queryEngine(t,x),e=b,q=[],k;g.observe=function(d,c){1==q.push(d)&&n.push(k=function(d,t){m(g,function(n){var g=n.length!=p.count,m,x;if(++e!=b)throw Error("Query is out of date, you must observe() the query prior to any data modifications");
var k,u=-1,w=-1;if(void 0!==t){m=0;for(x=n.length;m<x;m++){var A=n[m];if(f.getIdentity(A)==t){k=A;u=m;(a||!d)&&n.splice(m,1);break}}}if(a){if(d&&(a.matches?a.matches(d):a([d]).length))m=-1<u?u:n.length,n.splice(m,0,d),w=s.indexOf(a(n),d),n.splice(m,1),p.start&&0==w||!g&&w==n.length?w=-1:n.splice(w,0,d)}else d&&(void 0!==t?w=u:p.start||(w=f.defaultIndex||0,n.splice(w,0,d)));if((-1<u||-1<w)&&(c||!a||u!=w)){g=q.slice();for(m=0;n=g[m];m++)n(d||k,u,w)}})});var t={};t.remove=t.cancel=function(){var a=s.indexOf(q,
d);-1<a&&(q.splice(a,1),q.length||n.splice(s.indexOf(n,k),1))};return t}}return g};var t;g("put",function(b,d){f.notify(b,d)});g("add",function(b){f.notify(b)});g("remove",function(b){f.notify(void 0,b)});return f};c.setObject("dojo.store.Observable",g);return g})},"dgrid/extensions/ColumnHider":function(){define("dojo/_base/declare dojo/has dojo/on ../util/misc put-selector/put dojo/i18n!./nls/columnHider xstyle/css!../css/extensions/ColumnHider.css".split(" "),function(g,c,m,s,f,k){var n,b,d=c("ie"),
t=d&&c("quirks"),u=8>d||t?"htmlFor":"for";return g("dgrid.extensions.ColumnHider",null,{hiderMenuNode:null,hiderToggleNode:null,i18nColumnHider:k,_hiderMenuOpened:!1,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var b=this.subRows,d=!0,c,a,e,q;delete this._columnHiderFirstCheckbox;e=0;for(c=b.length;e<c;e++){q=0;for(a=b[e].length;q<a;q++)this._renderHiderMenuEntry(b[e][q]),d&&(d=!1,this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[b[e][q].id])}},_renderHiderMenuEntry:function(b){var d=
b.id,c=s.escapeCssIdentifier(d,"-"),a,e;b.hidden&&(b.hidden=!1,this._hideColumn(d),b.hidden=!0);b.unhidable||(a=f("div.dgrid-hider-menu-row"),e=this.domNode.id+"-hider-menu-check-"+c,d=this._columnHiderCheckboxes[d]=f(a,"input.dgrid-hider-menu-check.hider-menu-check-"+c+"[type\x3dcheckbox]"),d.id=e,f(a,"label.dgrid-hider-menu-label.hider-menu-label-"+c+"["+u+"\x3d"+e+"]",b.label||b.field||""),f(this.hiderMenuNode,a),b.hidden||(d.checked=!0))},renderHeader:function(){function c(a){a.stopPropagation()}
var g=this,k=this.hiderMenuNode,a=this.hiderToggleNode,e;this.inherited(arguments);if(k){for(e in this._columnHiderRules)this._columnHiderRules[e].remove();k.innerHTML=""}else a=this.hiderToggleNode=f(this.domNode,"button.ui-icon.dgrid-hider-toggle[type\x3dbutton][aria-label\x3d"+this.i18nColumnHider.popupTriggerLabel+"]"),this._listeners.push(m(a,"click",function(a){g._toggleColumnHiderMenu(a)})),k=this.hiderMenuNode=f("div.dgrid-hider-menu[role\x3ddialog][aria-label\x3d"+this.i18nColumnHider.popupLabel+
"]"),k.id=this.id+"-hider-menu",this._listeners.push(m(k,"keyup",function(b){if(27===(b.charCode||b.keyCode))g._toggleColumnHiderMenu(b),a.focus()})),k.style.display="none",f(this.domNode,k),this._listeners.push(m(k,".dgrid-hider-menu-check:"+(9>d||t?"click":"change"),function(a){g._updateColumnHiddenState(a.target.id.substr(g.id.length+18),!a.target.checked)})),this._listeners.push(m(k,"mousedown",c),m(a,"mousedown",c)),b||(b=m.pausable(document,"mousedown",function(a){n&&n._toggleColumnHiderMenu(a)}),
b.pause());this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries()},destroy:function(){this.inherited(arguments);for(var b in this._columnHiderRules)this._columnHiderRules[b].remove()},left:function(b,d){return this.right(b,-d)},right:function(b,d){b.element||(b=this.cell(b));for(var c=this.inherited(arguments),a=b;c.column.hidden;){c=this.inherited(arguments,[c,0<d?1:-1]);if(a.element===c.element)return b;a=c}return c},isColumnHidden:function(b){return!!this._columnHiderRules[b]},
_toggleColumnHiderMenu:function(){var d=this._hiderMenuOpened,c=this.hiderMenuNode,f=this.domNode,a;c.style.display=d?"none":"";d?c.style.height="":(c.offsetHeight>f.offsetHeight-12&&(c.style.height=f.offsetHeight-12+"px"),(a=this._columnHiderFirstCheckbox)&&a.focus());b[d?"pause":"resume"]();n=d?null:this;this._hiderMenuOpened=!d},_hideColumn:function(b){var d=this,f="#"+s.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-",a;if(!this._columnHiderRules[b]&&(this._columnHiderRules[b]=s.addCssRule(f+
s.escapeCssIdentifier(b,"-"),"display: none;"),(8===c("ie")||10===c("ie"))&&!c("quirks")))a=s.addCssRule(".dgrid-row-table","display: inline-table;"),window.setTimeout(function(){a.remove();d.resize()},0)},_showColumn:function(b){this._columnHiderRules[b]&&(this._columnHiderRules[b].remove(),delete this._columnHiderRules[b])},_updateColumnHiddenState:function(b,d){this[d?"_hideColumn":"_showColumn"](b);this.columns[b].hidden=d;m.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[b],
hidden:d,bubbles:!0});this.resize()},toggleColumnHiddenState:function(b,d){"undefined"===typeof d&&(d=!this._columnHiderRules[b]);this._updateColumnHiddenState(b,d);this._columnHiderCheckboxes[b].checked=!d}})})},"dgrid/extensions/ColumnResizer":function(){define("dojo/_base/declare dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-geometry dojo/has ../util/misc put-selector/put dojo/_base/html xstyle/css!../css/extensions/ColumnResizer.css".split(" "),function(g,c,m,s,f,k,n,b,d){function t(a){for(var b=
a.length,d=b,c=a[0].length,f=Array(b);b--;)f[b]=Array(c);for(var n={},b=0;b<d;b++)for(var t=f[b],m=a[b],g=0,p=0;g<c;g++){var k=m[p],u;if("undefined"==typeof t[g]){t[g]=k.id;if(k.rowSpan&&1<k.rowSpan){u=f;for(var s=k.rowSpan,x=b,w=g,G=k.id,C=1;C<s;C++)u[x+C][w]=G}if(0<b&&k.colSpan&&1<k.colSpan)for(u=1;u<k.colSpan;u++)if(t[++g]=k.id,k.rowSpan&&1<k.rowSpan)for(var s=f,x=k.rowSpan,w=b,G=g,C=k.id,H=1;H<x;H++)s[w+H][G]=C;n[k.id]=a[0][g].id;p++}}return n}function u(a,e,d,f,n){if(!(0>=d)){var t=a.columns[e],
g;if(t&&(g={grid:a,columnId:e,width:d,bubbles:!0,cancelable:!0},f&&(g.parentType=f),!a._resizedColumns||c.emit(a.headerNode,"dgrid-columnresize",g)))return"auto"===d?delete t.width:(t.width=d,d+="px"),(f=a._columnSizes[e])?f.set("width",d):f=b.addCssRule("#"+b.escapeCssIdentifier(a.domNode.id)+" .dgrid-column-"+b.escapeCssIdentifier(e,"-"),"width: "+d+";"),a._columnSizes[e]=f,!1!==n&&a.resize(),!0}}var p,w=0,x={create:function(){p=d("div.dgrid-column-resizer")},destroy:function(){d(p,"!");p=null},
show:function(a){a=k.position(a.domNode,!0);p.style.top=a.y+"px";p.style.height=a.h+"px";d(document.body,p)},move:function(a){p.style.left=a+"px"},hide:function(){p.parentNode.removeChild(p)}};return g("dgrid.extensions.ColumnResizer",null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);w++||x.create()},destroy:function(){this.inherited(arguments);for(var a in this._columnSizes)this._columnSizes[a].remove();--w||x.destroy()},
resizeColumnWidth:function(a,b){return u(this,a,b)},configStructure:function(){var a=this._oldColumnSizes=s.mixin({},this._columnSizes),b;this._resizedColumns=!1;this._columnSizes={};this.inherited(arguments);for(b in a)b in this._columnSizes||a[b].remove();delete this._oldColumnSizes},_configColumn:function(a){this.inherited(arguments);var d=a.id,c;"width"in a&&((c=this._oldColumnSizes[d])?c.set("width",a.width+"px"):c=b.addCssRule("#"+b.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+b.escapeCssIdentifier(d,
"-"),"width: "+a.width+"px;"),this._columnSizes[d]=c)},renderHeader:function(){this.inherited(arguments);var a=this,e;if(this.columnSets&&this.columnSets.length)for(var f=this.columnSets.length;f--;)e=s.mixin(e||{},t(this.columnSets[f]));else this.subRows&&1<this.subRows.length&&(e=t(this.subRows));for(var f=m(".dgrid-cell",a.headerNode),g=f.length;g--;){var k=f[g],p=k.columnId,u=a.columns[p],x=k.childNodes;if(u&&!1!==u.resizable){u=d("div.dgrid-resize-header-container");for(k.contents=u;0<x.length;)d(u,
x[0]);k=d(k,u,"div.dgrid-resize-handle.resizeNode-"+b.escapeCssIdentifier(p,"-"));k.columnId=e&&e[p]||p}}a.mouseMoveListen||(c(a.headerNode,".dgrid-resize-handle:mousedown"+(n("touch")?",.dgrid-resize-handle:touchstart":""),function(b){a._resizeMouseDown(b,this);a.mouseMoveListen.resume();a.mouseUpListen.resume()}),a._listeners.push(a.mouseMoveListen=c.pausable(document,"mousemove"+(n("touch")?",touchmove":""),b.throttleDelayed(function(b){a._updateResizerPosition(b)}))),a._listeners.push(a.mouseUpListen=
c.pausable(document,"mouseup"+(n("touch")?",touchend":""),function(b){a._resizeMouseUp(b);a.mouseMoveListen.pause();a.mouseUpListen.pause()})),a.mouseMoveListen.pause(),a.mouseUpListen.pause())},_resizeMouseDown:function(a,d){a.preventDefault();f.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(a);this._targetCell=m(".dgrid-column-"+b.escapeCssIdentifier(d.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(a);x.show(this)},_resizeMouseUp:function(a){var d=this._columnSizes,
c,g,t;this.adjustLastColumn&&(t=this.headerNode.clientWidth-1);this._resizedColumns||(c=m(".dgrid-cell",this.headerNode),this.columnSets&&this.columnSets.length?c=c.filter(function(a){return"0"==a.columnId.split("-")[0]&&!(a.columnId in d)}):this.subRows&&1<this.subRows.length&&(c=c.filter(function(a){return"0"==a.columnId.charAt(0)&&!(a.columnId in d)})),g=c.map(function(a){return a.offsetWidth}),c.forEach(function(a,b){u(this,a.columnId,g[b],null,!1)},this),this._resizedColumns=!0);f.setSelectable(this.domNode,
!0);c=this._targetCell;var n=this._getResizeMouseLocation(a)-this._startX,k=c.offsetWidth+n,p=this._getResizedColumnWidths(),s=p.totalWidth,p=p.lastColId,w=m(".dgrid-column-"+b.escapeCssIdentifier(p,"-"),this.headerNode)[0].offsetWidth;k<this.minWidth&&(k=this.minWidth);u(this,c.columnId,k,a.type)&&c.columnId!=p&&this.adjustLastColumn&&(s+n<t?u(this,p,"auto",a.type):w-n<=this.minWidth&&u(this,p,this.minWidth,a.type));x.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(a){if(this._targetCell){a=
this._getResizeMouseLocation(a);var b=this._targetCell.offsetWidth,d=a;b+(a-this._startX)<this.minWidth&&(d=this._startX-(b-this.minWidth));x.move(d)}},_getResizeMouseLocation:function(a){var b=0;a.pageX?b=a.pageX:a.clientX&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);return b},_getResizedColumnWidths:function(){var a=0,b=m((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),d=b.length;if(!d)return{};for(var c=b[d-1].columnId;d--;)a+=
b[d].offsetWidth;return{totalWidth:a,lastColId:c}}})})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(g,c,m,s,f,k,n){g=g(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var b=m.map(this.geometries1,function(b){return b.toJson()}),d=m.map(this.geometries2,function(b){return b.toJson()}),
c={},f=this.geometries1;f&&0<f.length&&(c.geometries1=s.toJson({geometryType:n.getJsonType(f[0]),geometries:b}),b=this.geometries1[0].spatialReference,c.sr=b.wkid?b.wkid:s.toJson(b.toJson()));if((b=this.geometries2)&&0<b.length)c.geometries2=s.toJson({geometryType:n.getJsonType(b[0]),geometries:d});this.relation&&(c.relation=this.relation);this.relationParam&&(c.relationParam=s.toJson(this.relationParam));return c}});c.mixin(g,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",
SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});
return g})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(g,c,m,s,f,k,n,b){m("dijit-legacy-requires")&&f(0,function(){g(["dijit/ToolbarSeparator"])});return c("dijit.Toolbar",[k,b,n],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},
_onRightArrow:function(){this.focusNext()}})})},"widgets/AttributeTable/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),function(g,c,m,s,f,k){return g(null,{queryUrl:"",idProperty:"id",data:null,_entityData:null,constructor:function(c){g.safeMixin(this,c);this.data=[];this._entityData=[];this.layer=c.layer;this.objectIds=c.objectIds;this.where=c.where;this.orderByFields=c.orderByFields;
this.totalCount=c.totalCount;this.batchCount=c.batchCount||25;this.idProperty=this.layer.objectIdField;this.layer&&this.layer.url&&(this.queryTask=new f(this.layer.url))},get:function(c){return this.data[c]},getIdentity:function(c){return c[this.idProperty]},query:function(f,b){var d=new s,g=b&&b.start||0,u=this.batchCount;if(this.objectIds){var p=null,p="function"===typeof f?m.filter(this.objectIds,c.hitch(this,function(b){return f(b)})):this.objectIds;d.objectIds=p.length>=g+this.batchCount?p.slice(g,
g+u):p.slice(g)}else d.start=g,d.num=u,d.where=this.where,d.orderByFields=this.orderByFields;d.returnGeometry=!1;d.outFields=["*"];var w=this.totalCount,g=null,g=!d.where;if(!(d.objectIds&&0<d.objectIds.length)&&g)return new k([]);g=this.queryTask?this.queryTask.execute(d):this.layer.queryFeatures(d);g.total=g.then(c.hitch(this,function(b){var a=0,c=this.layer.objectIdField;if(this.objectIds){if(!c)for(a=0;a<b.fields.length;a++)if("esriFieldTypeOID"===b.fields[a].type){c=b.fields[a].name;break}for(var f=
{},a=0;a<b.features.length;a++)f[b.features[a].attributes[c]]=b.features[a];b.features=m.map(d.objectIds,function(a){return f[a]})}for(a=0;a<b.features.length;a++)b.features[a]&&(b.features[a]=b.features[a].attributes,this.data[b.features[a][c]]=b.features[a],this._entityData.push(b.features[a]));b=b.features;return w}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");return 0});return new k(g)}})})},"widgets/AttributeTable/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),
function(g,c,m,s){var f=function(k){function n(b){k[b]||(k[b]=function(){var d=arguments;return s.when(k,function(c){Array.prototype.unshift.call(d,c.features||c);return f(m[b].apply(m,d))})})}if(!k)return k;k.then&&(k=c.delegate(k));k.total||(k.total=s.when(k,function(b){return g._isDefined(b.total)?b.total:b.length||0}));n("forEach");n("filter");n("map");n("some");n("every");return k};return f})},"widgets/AttributeTable/utils":function(){define(["dojo/_base/lang","dojo/_base/array","jimu/LayerInfos/LayerInfos",
"dojo/Deferred","dojo/promise/all"],function(g,c,m,s,f){function k(b){var d=[],f=[];c.forEach(b,function(b){0>d.indexOf(b.name)?d.push(b.name):f.push(b)});c.forEach(f,function(b){b.name=b.name+"-"+b.id})}var n={readLayerInfosObj:function(b){return m.getInstance(b,b.itemInfo)},readLayerInfosFromMap:function(b){var d=new s;m.getInstance(b,b.itemInfo).then(g.hitch(this,function(b){var c=[];b.traversal(g.hitch(this,function(b){c.push(b)}));b=b.getTableInfoArray();c=c.concat(b);d.resolve(c)}),g.hitch(this,
function(b){console.error(b);d.reject(b)}));return d.promise},readLayerObjectsFromMap:function(b){var d=new s,k=[];this.readLayerInfosFromMap(b).then(g.hitch(this,function(b){c.forEach(b,g.hitch(this,function(b){k.push(b.getLayerObject())}));f(k).then(g.hitch(this,function(b){d.resolve(b)}),g.hitch(this,function(b){d.reject(b);console.error(b)}))}),g.hitch(this,function(b){d.reject(b)}));return d.promise},readSupportTableInfoFromLayerInfos:function(b){var d=new s,k=[];c.forEach(b,g.hitch(this,function(b){k.push(b.getSupportTableInfo())}));
f(k).then(g.hitch(this,function(f){f=g.clone(f);c.forEach(f,function(d,c){d.id=b[c].id});d.resolve(f)}),function(b){d.reject(b)});return d.promise},readConfigLayerInfosFromMap:function(b){var d=new s,m=[];this.readLayerInfosFromMap(b).then(g.hitch(this,function(b){var n=[];c.forEach(b,function(b){m.push(b.getSupportTableInfo())});f(m).then(g.hitch(this,function(f){c.forEach(f,g.hitch(this,function(d,a){d.isSupportedLayer&&(b[a].name=b[a].title,n.push(b[a]))}));k(n);d.resolve(n)}),g.hitch(this,function(b){d.reject(b)}))}),
g.hitch(this,function(b){d.reject(b)}));return d.promise},getConfigInfosFromLayerInfos:function(b){return c.map(b,function(b){return n.getConfigInfoFromLayerInfo(b)})},getConfigInfoFromLayerInfo:function(b){var d={};d.name=b.name||b.title;d.id=b.id;d.show=b.isShowInMap();d.layer={url:b.getUrl()||b.layerObject&&b.layerObject.url};if((b=b.getPopupInfo())&&!b.description)d.layer.fields=c.map(b.fieldInfos,function(b){return{name:b.fieldName,alias:b.label.toLowerCase(),show:b.visible}});return d}};return n})},
"widgets/AttributeTable/PopupHandler":function(){define("dojo/_base/declare dojo/_base/lang dijit/_WidgetBase dojo/on jimu/LayerInfos/LayerInfos jimu/InfoWindowAction".split(" "),function(g,c,m,s,f,k){return g([m],{postCreate:function(){this.inherited(arguments);f.getInstance(this.map,this.map.itemInfo).then(c.hitch(this,function(c){this.layerInfos=c}));this.showRelatedTableBtn=new k({buttonInfo:{title:this.nls.showRelatedRecords,baseClass:"relationship"}});this.own(s(this.showRelatedTableBtn,"buttonClick",
c.hitch(this,this._onRealtionshipClick)));this.own(s(this.showRelatedTableBtn,"selectionChange",c.hitch(this,this._onSelectionChange)))},_onRealtionshipClick:function(c){var b=this.layerInfos.getLayerInfoById(c._layer.id);this.attrWidget.showRelatedRecordsFromPopup(b,[c.attributes[c._layer.objectIdField]])},_onSelectionChange:function(c){this.layerInfos&&c._layer&&c._layer.relationships&&0<c._layer.relationships.length?this.showRelatedTableBtn.enableButtonNode():this.showRelatedTableBtn.disableButtonNode()},
destroy:function(){this.showRelatedTableBtn.destroy();this.inherited(arguments)}})})},"jimu/InfoWindowAction":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/Evented dojo/on dojo/query jimu/MapManager".split(" "),function(g,c,m,s,f,k,n,b){return g([s,f],{popup:null,popupMobile:null,buttonInfo:null,postCreate:function(){this.inherited(arguments);this.buttonInfo&&this._addButtonNode()},constructor:function(){var d=b.getInstance().getMapInfoWindow();this.popup=
d.bigScreen;this.popupMobile=d.mobile},_addButtonNode:function(){this._addButtonNodeToPopup();this._addButtonNodeToPopupMobile()},_addButtonNodeToPopup:function(){var b=n(".actionList",this.popup.domNode)[0],b=m.create("a",{"class":"action "+this.buttonInfo.baseClass,href:" javascript:void(0);"},b);this.popupButtonNode=m.create("span",{innerHTML:this.buttonInfo.title,style:"display: none"},b);this.own(k(this.popupButtonNode,"click",c.hitch(this,this._onButtonClick)));this.own(k(this.popup,"selection-change",
c.hitch(this,this._onSelectionChange,this.popup)))},_addButtonNodeToPopupMobile:function(){var b=n(".esriMobilePopupInfoView .esriMobileInfoViewItem"),b=m.create("a",{"class":"action "+this.buttonInfo.baseClass,href:" javascript:void(0);"},b[b.length-1]);this.popupMobileButtonNode=m.create("span",{innerHTML:this.buttonInfo.title,style:"display: none"},b);this.own(k(this.popupMobileButtonNode,"click",c.hitch(this,this._onButtonClick)));this.own(k(this.popupMobile,"selection-change",c.hitch(this,this._onSelectionChange,
this.popupMobile)))},enableButtonNode:function(){m.setStyle(this.popupButtonNode,"display","inline");m.setStyle(this.popupMobileButtonNode,"display","inline")},disableButtonNode:function(){m.setStyle(this.popupButtonNode,"display","none");m.setStyle(this.popupMobileButtonNode,"display","none")},_onButtonClick:function(){this.emit("buttonClick",this._selectedFeature)},_onSelectionChange:function(b,c){-1<c.target.selectedIndex&&(this._selectedFeature=b.getSelectedFeature(),this.emit("selectionChange",
this._selectedFeature))}})})},"widgets/AttributeTable/_build-generate_module":function(){define(["dojo/text!./css/style.css","dojo/i18n!./nls/strings","dojo/text!./config.json"],function(){})},"url:dijit/layout/templates/TabContainer.html":'\x3cdiv class\x3d"dijitTabContainer"\x3e\r\n\t\x3cdiv class\x3d"dijitTabListWrapper" data-dojo-attach-point\x3d"tablistNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"tablistSpacer" class\x3d"dijitTabSpacer ${baseClass}-spacer"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTabPaneWrapper ${baseClass}-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/_TabButton.html":'\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"titleNode,innerDiv,tabContent" class\x3d"dijitTabInner dijitTabContent"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTabButtonIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d\'containerNode,focusNode\' class\x3d\'tabLabel\'\x3e\x3c/span\x3e\r\n\t\x3cspan class\x3d"dijitInline dijitTabCloseButton dijitTabCloseIcon" data-dojo-attach-point\x3d\'closeNode\'\r\n\t\t  role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d\'closeText\' class\x3d\'dijitTabCloseText\'\x3e[x]\x3c/span\r\n\t\t\t\t\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/ScrollingTabController.html":'\x3cdiv class\x3d"dijitTabListContainer-${tabPosition}" style\x3d"visibility:hidden"\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerMenuButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_menuBtn"\r\n\t\t data-dojo-props\x3d"containerId: \'${containerId}\', iconClass: \'dijitTabStripMenuIcon\',\r\n\t\t\t\t\tdropDownPosition: [\'below-alt\', \'above-alt\']"\r\n\t\t data-dojo-attach-point\x3d"_menuBtn" showLabel\x3d"false" title\x3d""\x3e\x26#9660;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_leftBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideLeftIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_leftBtn" data-dojo-attach-event\x3d"onClick: doSlideLeft"\x3e\x26#9664;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_rightBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideRightIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_rightBtn" data-dojo-attach-event\x3d"onClick: doSlideRight"\x3e\x26#9654;\x3c/div\x3e\r\n\t\x3cdiv class\x3d\'dijitTabListWrapper\' data-dojo-attach-point\x3d\'tablistWrapper\'\x3e\r\n\t\t\x3cdiv role\x3d\'tablist\' data-dojo-attach-event\x3d\'onkeydown:onkeydown\'\r\n\t\t\t data-dojo-attach-point\x3d\'containerNode\' class\x3d\'nowrapTabStrip\'\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/layout/templates/_ScrollingTabControllerButton.html":'\x3cdiv data-dojo-attach-event\x3d"ondijitclick:_onClick" class\x3d"dijitTabInnerDiv dijitTabContent dijitButtonContents"  data-dojo-attach-point\x3d"focusNode" role\x3d"button"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitTabStripIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d"containerNode,titleNode" class\x3d"dijitButtonText"\x3e\x3c/span\x3e\r\n\x3c/div\x3e',
"url:widgets/AttributeTable/css/style.css":'.jimu-widget-attributetable{z-index: 101;}.jimu-widget-attributetable .jimu-loading-indicator{z-index: 1000;}.jimu-widget-attributetable-main .tabStripButton{height: 24px !important;}.jimu-widget-attributetable, .jimu-widget-attributetable-main{width: 100%; height: 100%; left: 0px; bottom: 0px; background-color: #efefef;}.jimu-widget-attributetable-main{overflow: hidden;}.jimu-widget-attributetable-move{width: 100%; height: 7px; top: 0px;}.jimu-widget-attributetable-move:hover{cursor: n-resize;}.jimu-widget-attributetable-move:hover .jimu-widget-attributetable-thumb{background-color: #fff;}.jimu-widget-attributetable-thumb{background: #B0B0B0 none; height: 1px; width: 19px; margin: 3px auto; position: absolute; left: 0; right: 0;}.jimu-widget-attributetable-indicate-vertical{width: 2px; height: 100%; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-indicate-horizontal{width: 100%; height: 2px; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-bar{width: 63px; height: 17px; left: 0; right: 0; top: -17px; margin: auto; position: absolute; background-color: #efefef; cursor: pointer; border: 1px solid #fff; border-radius: 2px 2px 0 0; background-position: center; background-repeat: no-repeat;}.jimu-widget-attributetable-bar:hover{background-color: #bfbfbf;}.jimu-widget-attributetable-bar.open{background-image: url(images/arrow_down.png); border: none; border-bottom-left-radius: 0; border-bottom-right-radius: 0;}.jimu-widget-attributetable-bar.close{background-image: url(images/arrow_up.png)}.jimu-widget-attributetable-arrowImage{width: 30px; height: 30px; left: 48%; top: -30px; position: absolute; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; background-position: center center; background-repeat: no-repeat; cursor: ns-resize; background-color: rgba(0, 0, 0, 0.8);}.dijitTabPaneWrapper .dijitTabContainerTop-container .dijitAlignCenter{height: 100%;}.jimu-widget-attributetable .dijitTabContainerTopChildWrapper,.jimu-widget-attributetable .dijitTabContainerTopChildWrapper .dijitContentPane{height: 100%;}.jimu-widget-attributetable .esriAttributeTable{width: 100%; height: 100%; position: relative;}.jimu-widget-attributetable .esriAttributeTableToolbar{width: 100%; height: 30px; left: 0px; top: 0px; z-index: 100; position: relative;}.jimu-widget-attributetable .dgrid-sortable {font-weight: bold;}.jimu-widget-attributetable .dgrid-cell {border-right: solid 1px #ccc; width: 100px;}.jimu-widget-attributetable .dgrid-row .dgrid-cell {border:medium none; padding: 7px 3px; border-right: 1px solid #CCCCCC;}.jimu-rtl .jimu-widget-attributetable .dgrid-cell {text-align: right;}.jimu-widget-attributetable .dgrid-header {overflow: hidden; background-color: #eee;}.jimu-widget-attributetable .dgrid-cell a{color: #21759B; text-decoration: none;}.jimu-widget-attributetable .dgrid-cell a:hover, a:active{text-decoration: underline;}.jimu-widget-attributetable .dgrid-row {border: medium none;}.jimu-widget-attributetable .dgrid-row:hover {background-color:#E1F0FB;}.jimu-widget-attributetable .dgrid-row-even{background-color: #FFF;}.jimu-widget-attributetable .dgrid-row-odd {background-color: #F7F8F8;}.jimu-widget-attributetable .ui-state-active {background-color: #AEC7E3;}.jimu-widget-attributetable .dgrid-status {white-space: pre;}.jimu-widget-attributetable .self-footer {display: inline-block;}.jimu-rtl .dgrid-hider-menu-check{right: 2px; left: auto;}.jimu-rtl .dgrid-hider-menu-label {padding-left: 0; padding-right: 20px;}.jimu-rtl .jimu-widget-attributetable .dgrid-pagination .dgrid-status{float: right !important;}.jimu-rtl .dgrid-pagination .dgrid-navigation,.jimu-rtl .dgrid-pagination .dgrid-page-size{float: left !important;}.esriAttributeTableExportImage{background-image: url("../images/export.png"); width: 13px; height: 13px;}.esriAttributeTableZoomImage{background-image: url("../images/zoom.png"); width: 13px; height: 13px;}.esriAttributeTableSelectAllImage{background-image: url("../images/select.png"); width: 13px; height: 13px;}.esriAttributeTableSelectPageImage{background-image: url("../images/page.png"); width: 13px; height: 13px;}.esriAttributeTableClearImage{background-image: url("../images/clear.png"); width: 13px; height: 13px;}.esriAttributeTableOptionsImage{background-image: url("../images/more.png"); width: 13px; height: 13px;}.esriAttributeTableRefreshImage{background-image: url("../images/refresh.png"); width: 13px; height: 13px;}.esriAttributeTableSymbolImage{background-image: url("../images/symbol.png"); width: 13px; height: 13px;}.esriAttributeTableCloseImage{background-image: url("../images/close.png"); width: 13px; height: 13px;}.esriAttributeTableColumnsImage{background-image: url("../images/columns.png"); width: 13px; height: 13px;}',
"url:widgets/AttributeTable/config.json":'{\r\n  "layerInfos": [],\r\n  "table": {\r\n    "pageSizeOptions": [25, 50, 100, 1000]\r\n  },\r\n  "hideExportButton": false\r\n}',"*now":function(g){g(['dojo/i18n!*preload*widgets/AttributeTable/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","ROOT"]'])}}});
define("dojo/_base/declare dojo/_base/html dijit/_WidgetsInTemplateMixin jimu/BaseWidget dijit/layout/TabContainer dijit/layout/ContentPane jimu/utils jimu/dijit/Message dgrid/OnDemandGrid dgrid/Selection dojo/store/Cache dojo/store/Memory dojo/store/Observable dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer dojo/dom-construct dojo/dom-style dojo/dom-attr dojo/dom-class dojo/Deferred esri/config esri/main esri/request esri/tasks/RelationParameters esri/layers/GraphicsLayer esri/layers/FeatureLayer esri/tasks/QueryTask esri/tasks/query esri/tasks/RelationshipQuery esri/tasks/ProjectParameters esri/graphic esri/geometry/Point esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color esri/geometry/normalizeUtils dojo/_base/lang dojo/on dojo/touch dojo/topic dojo/aspect dojo/_base/array dojo/has dojo/query dojo/_base/window dijit/Toolbar dijit/form/Button dijit/DropDownMenu dijit/MenuItem dijit/CheckedMenuItem dijit/form/DropDownButton jimu/dijit/LoadingIndicator ./FeatureLayerQueryStore ./utils ./PopupHandler".split(" "),function(g,
c,m,s,f,k,n,b,d,t,u,p,w,x,a,e,q,I,A,B,M,Z,$,Q,S,R,N,D,aa,G,C,H,T,ba,ca,U,V,W,da,l,y,O,X,ea,z,Y,P,fa,ga,J,ha,K,ia,ja,L,ka,E,la){m=g([s,m],{name:"AttributeTable",baseClass:"jimu-widget-attributetable",normalHeight:0,_defaultFeatureCount:2E3,_defaultBatchCount:25,_batchCount:0,_layerTypes:{FEATURELAYER:"FeatureLayer",IMAGELAYER:"ImageLayer",TABLE:"Table",RELATIONSHIPTABLE:"RelationshipTable"},postMixInProperties:function(){this.nls.features=this.nls.features||"features"},startup:function(){this.inherited(arguments);
n.loadStyleLink("dgrid",apiUrl+"dgrid/css/dgrid.css");this.AttributeTableDiv=null;this.layers=[];this.loadings=[];this.configLayerInfos=[];this._delayedLayerInfos=[];this._allLayerInfos=[];this.grids=[];this.gridFooters=[];this.relationshipsSet={};this.relationLoadingSet={};this.relationGridsSet={};this.relationGridFootersSet={};this.relationTabPagesSet={};this.relationSelectedRowsLabelDivsSet={};this.currentRelationshipKey=null;this.selections=[];this.selectedRowsLabelDivs=[];this.tabContainer=this.toolbarDiv=
null;this.layerTabPages=[];this.moveMaskDiv=this.refreshButton=this.selectionMenu=this.exportButton=this.zoomButton=this.tableDiv=null;this.moveMode=!1;this.bottomPosition=this.toolbarHeight=this.noGridHeight=this.previousGridHeight=this.previousDomHeight=this.moveY=0;this.matchingCheckBox=null;this.layersIndex=-1;this.matchingMap=!1;this.showing=!0;this.graphicsLayers=[];this.isFirst=!0;this.currentHeight=0;this.setInitialPosition();this.openHeight=this.normalHeight;this._dragingHandlers=[];this.own(X.subscribe("changeMapPosition",
l.hitch(this,this._onMapPositionChange)));E.readLayerInfosObj(this.map).then(l.hitch(this,function(h){this.own(y(h,"layerInfosIsShowInMapChanged",l.hitch(this,this.onLayerInfosIsShowInMapChanged)));this.own(h.on("layerInfosChanged",l.hitch(this,this.onLayerInfosChanged)));this._createBar();this._closeTable()}));this.popupHandler=new la({map:this.map,attrWidget:this,nls:this.nls})},_createBar:function(){this.arrowDiv=e.create("div");A.add(this.arrowDiv,"jimu-widget-attributetable-move");c.create("div",
{"class":"jimu-widget-attributetable-thumb"},this.arrowDiv);this.bar=e.create("div");A.add(this.bar,"jimu-widget-attributetable-bar");e.place(this.bar,this.domNode);e.place(this.arrowDiv,this.domNode);this.moveMaskDiv=e.create("div",{style:"opacity:0; width:100%; height:100%;position:absolute; z-index:999; display:none;cursor: ns-resize","class":"jimu-widget-attributetable-mask"});e.place(this.moveMaskDiv,fa.body(),"first");this.own(y(this.arrowDiv,"mousedown",l.hitch(this,this._onDragStart)));this.own(y(this.arrowDiv,
O.press,l.hitch(this,this._onDragStart)));this.own(y(this.bar,"click",l.hitch(this,this._switchTable)))},_switchTable:function(){0===this.currentHeight?this._openTable():this._closeTable()},_openTable:function(){var h=new B;this.isFirst?(this.currentHeight=this.normalHeight,this.isFirst=!1,this.loading||(this.loading=new L),this.loading.placeAt(this.domNode),this.loading.show(),E.readConfigLayerInfosFromMap(this.map).then(l.hitch(this,function(a){if(0===this.config.layerInfos.length){var b=E.getConfigInfosFromLayerInfos(a);
this.config.layerInfos=z.filter(b,function(h){return h.show})}else this.config.layerInfos=z.filter(l.clone(this.config.layerInfos),function(h){return h.show});this._allLayerInfos=a;this._processDelayedLayerInfos();this._init();this.showRefreshing(!1);h.resolve()}),l.hitch(this,function(h){console.error(h)}))):h.resolve();A.remove(this.bar,"close");A.add(this.bar,"open");this._changeLeftPostion();this._changeHeight(this.openHeight);I.set(this.bar,"title",this.nls.closeTableTip);return h},_closeTable:function(){A.remove(this.bar,
"open");A.add(this.bar,"close");this._changeHeight(0);this.showRefreshing(!1);I.set(this.bar,"title",this.nls.openTableTip)},_init:function(){this.initConfigLayerInfos();this.initDiv();this.resize();this.own(y(this.map,"extent-change",l.hitch(this,this.onExtentChange)));this.own(y(this.map,"layer-remove",l.hitch(this,this.onRemoveLayer)));this.own(y(this.map,"resize",l.hitch(this,this.onMapResize)));this.own(y(window.document,"mouseup",l.hitch(this,this._onDragEnd)));this.own(y(window.document,"mousemove",
l.hitch(this,this._onDraging)));this.own(y(window.document,O.move,l.hitch(this,this._onDraging)));this.own(y(window.document,O.release,l.hitch(this,this._onDragEnd)))},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(z.forEach(this._delayedLayerInfos,l.hitch(this,function(h){this._getLayerInfoById(h.id)||this._allLayerInfos.push(h)})),this._delayedLayerInfos=[])},onLayerInfosIsShowInMapChanged:function(){this.checkMapInteractiveFeature()},onLayerInfosChanged:function(h,a,b){"added"!==
a||(!b||!h)||b.getSupportTableInfo().then(l.hitch(this,function(h){h.isSupportedLayer&&(0===this._allLayerInfos.length?this._delayedLayerInfos.push(b):0<this._allLayerInfos.length&&!this._getLayerInfoById(b.id)&&(this._allLayerInfos.push(b),this.initConfigLayerInfos(),this.getExistLayerTabPage(b.id)&&(this._startQueryOnLayerTab(b.id),this.onMapResize(),this.resetButtonStatus())))}))},destroy:function(){var h,a;h=this.layerTabPages.length;for(a=0;a<h;a++)this.layerTabPages[a].destroy();this.layerTabPages=
null;for(var b in this.relationTabPagesSet)this.relationTabPagesSet[b]&&this.relationTabPagesSet[b].destroy();this.tabContainer&&this.tabContainer.destroy();this.configLayerInfos=this._allLayerInfos=this.selectedRowsLabelDivs=this.grids=this.layers=null;this.layersIndex=-1;this.exportButton=this.zoomButton=this.tableDiv=null;this.moveMaskDiv&&(e.destroy(this.moveMaskDiv),this.moveMaskDiv=null);this.selectionMenu&&this.selectionMenu.destroy();this.refreshButton=this.selectionMenu=null;this.AttributeTableDiv&&
(e.empty(this.AttributeTableDiv),this.AttributeTableDiv=null);h=this.graphicsLayers.length;for(a=0;a<h;a++)this.graphicsLayers[a]&&this.map.removeLayer(this.graphicsLayers[a]);this.popupHandler.destroy();this.inherited(arguments)},onOpen:function(){if(this.config.layerInfos.length)q.set(this.domNode,"display",""),this.showing=!0,this.onMapResize();else this.onClose()},onClose:function(){},_changeHeight:function(h){q.set(this.domNode,"height",h+"px");this.tabContainer&&(this.tabContainer.domNode&&
0<=h-this.toolbarHeight)&&q.set(this.tabContainer.domNode,"height",h-this.toolbarHeight+"px");for(var a=this.grids.length,b=0;b<a;b++)this.grids[b]&&0<=h-this.noGridHeight&&q.set(this.grids[b].domNode,"height",h-this.noGridHeight+"px");for(var v in this.relationGridsSet)(a=this.relationGridsSet[v])&&0<=h-this.noGridHeight&&q.set(a.domNode,"height",h-this.noGridHeight+"px");this.refreshGridHeight();"browser"===this.positionRelativeTo&&X.publish("changeMapPosition",{bottom:h+this.bottomPosition});this.currentHeight=
h;0!==h?(this.openHeight=h,c.setStyle(this.arrowDiv,"display","block")):c.setStyle(this.arrowDiv,"display","none")},_changeLeftPostion:function(){var h=c.getMarginBox(jimuConfig.layoutId),a=c.getMarginBox(this.map.root),h=h.w-a.w;0<h&&(window.isRTL?c.setStyle(this.domNode,"right",h+"px"):c.setStyle(this.domNode,"left",h+"px"))},_onMapPositionChange:function(h){h&&isFinite(h.left)&&(window.isRTL?c.setStyle(this.domNode,"right",(h.left||0)+"px"):c.setStyle(this.domNode,"left",(h.left||0)+"px"),this.tabContainer&&
this.tabContainer.resize())},onMapResize:function(){var h=P(".dgrid-content"),a=q.get(this.domNode,"width");z.forEach(h,l.hitch(this,function(h){h.style.width=a-33+"px"}));if(-1<this.layersIndex){if((h=P(".dijitTabPaneWrapper"))&&h[0])h[0].style.width=a-5+"px";for(var h=this.layerTabPages.length,b=0;b<h;b++)q.set(this.layerTabPages[b].domNode,"width",a-18+"px"),this.grids[b]&&q.set(this.grids[b].domNode,"width",a-18+"px");this.grids[this.layersIndex]&&this.grids[this.layersIndex].resize()}for(var v in this.relationshipsSet)this.relationshipsSet[v]&&
(this.relationTabPagesSet[v]&&q.set(this.relationTabPagesSet[v].domNode,"width",a-18+"px"),this.relationGridsSet[v]&&(q.set(this.relationGridsSet[v].domNode,"width",a-18+"px"),this.relationGridsSet[v].resize()))},onPositionChange:function(h){this.position=h;this.setInitialPosition();this._changeHeight(0);h=q.get(this.domNode,"height");if(-1<this.layersIndex)for(var a=this.grids.length,b=0;b<a;b++)this.grids[b]&&q.set(this.grids[b].domNode,"height",h-this.noGridHeight+"px");this.refreshGridHeight();
this.showRefreshing(!1)},onRemoveLayer:function(h){for(var a=this.layers.length,b=0;b<a;b++)if(this.getLayerInfoId(this.configLayerInfos[b])===this.getLayerInfoId(h.layer)){this.layerTabPageClose(this.layerTabPages[b].id,!0);break}},initConfigLayerInfos:function(){var h=this.config.layerInfos.length;this.configLayerInfos=[];if(0<h)for(var a=0;a<h;a++){var b=this._getLayerInfoById(this.config.layerInfos[a].id);this.configLayerInfos[a]=b}},initSelectedLayer:function(h,a){this.layers[a]||(this.layers[a]=
h,this.graphicsLayers[a]=new S,this.map.addLayer(this.graphicsLayers[a]))},_getLayerInfoByName:function(h){for(var a=0;a<this._allLayerInfos.length;a++)if(this._allLayerInfos[a].name===h)return this._allLayerInfos[a]},_getLayerInfoById:function(h){for(var a=0,b=this._allLayerInfos.length;a<b;a++)if(this._allLayerInfos[a].id===h)return this._allLayerInfos[a]},_getRelationShipsByLayer:function(h){var a=[];h=h.relationships;for(var b in this.relationshipsSet)for(var v=0,c=h.length;v<c;v++)b===h[v]._relKey&&
a.push(h[v]);return a},onGraphicClick:function(h,a){this.showing&&h===this.layersIndex&&(this.highlightRow(a.graphic.attributes[this.layers[this.layersIndex].objectIdField]+""),this.selectFeatures("mapclick",[a.graphic]))},highlightRow:function(h){if(this.showing){var a=this.grids[this.layersIndex].store,b=-1,v;for(v in a.index)if(v===h){b=a.index[v];break}-1<b&&(a=this.grids[this.layersIndex].get("rowsPerPage"),b=parseInt(b/a,10),b++,this.grids[this.layersIndex].gotoPage(b),this.grids[this.layersIndex].clearSelection(),
this.grids[this.layersIndex].select(h),this.resetButtonStatus())}},_clipValidFields:function(h,a){if(!h||!h.length)return a||[];if(!a||!a.length)return h;for(var b=[],v=0,c=h.length;v<c;v++)for(var d=h[v],e=0,f=a.length;e<f;e++)if(a[e].name===d.name){b.push(d);break}return b},_getLayerIndexById:function(h){for(var a=0,b=this.config.layerInfos.length,a=0;a<b;a++)if(this.configLayerInfos[a]&&this.getLayerInfoId(this.configLayerInfos[a])===h)return a;return-1},_collectRelationShips:function(h,a){var b=
h.relationships,v=a.tilte||a.name;if(b&&0<b.length)for(var c=0,d=b.length;c<d;c++){var e=a.id+"_"+b[c].name+"_"+b[c].id;b[c]._relKey=e;b[c]._unionName=v+"_"+b[c].name;b[c]._layerInfoId=a.id;this.relationshipsSet[e]||(this.relationshipsSet[e]=b[c],this.relationshipsSet[e].objectIdField=h.objectIdField)}},_startQueryOnLayerTab:function(h){this.layersIndex=this._getLayerIndexById(h);-1<this.layersIndex&&this.configLayerInfos[this.layersIndex]&&this.configLayerInfos[this.layersIndex].getLayerObject().then(l.hitch(this,
function(h){this._collectRelationShips(h,this.config.layerInfos[this.layersIndex]);this.configLayerInfos[this.layersIndex].getSupportTableInfo().then(l.hitch(this,function(a){a.isSupportQuery?(this.initSelectedLayer(h,this.layersIndex),this.checkMapInteractiveFeature(),this.config.layerInfos[this.layersIndex].layer.fields=this._clipValidFields(this.config.layerInfos[this.layersIndex].layer.fields,this.layers[this.layersIndex].fields),this.config.layerInfos[this.layersIndex].opened?this.matchingMap?
this.startQuery(this.layersIndex,this.map.extent):(a=this.grids[this.layersIndex])&&a.store&&a.store.data&&this.exportButton?this.exportButton.set("disabled",!1):this.exportButton&&this.exportButton.set("disabled",!0):this.matchingMap?this.startQuery(this.layersIndex,this.map.extent):(this.config.layerInfos[this.layersIndex].opened=!0,this.startQuery(this.layersIndex))):(a=c.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),c.empty(this.layerTabPages[this.layersIndex].content),e.place(a,
this.layerTabPages[this.layersIndex].content),this.refreshGridHeight())}),l.hitch(this,function(h){new b({message:h.message||h})}))}),l.hitch(this,function(h){new b({message:h.message||h})}))},_startQueryOnRelationTab:function(h,a,b){var v=this.relationshipsSet[h];if(v&&!v.opened&&a&&0<a.length){this.showRelationLoading(h,!0);var d=new aa;d.objectIds=a;d.outFields=["*"];d.relationshipId=v.id;d.returnGeometry=!1;this.layers[b].url&&this.config.layerInfos[b].layer.url&&(a=this.layers[b].url.split("/"),
a[a.length-1]=v.relatedTableId,a=a.join("/"),$({url:a,content:{f:"json"},hangleAs:"json",callbackParamName:"callback"}).then(l.hitch(this,function(a){this.layers[b].queryRelatedFeatures(d,l.hitch(this,function(b){var F={displayFieldName:this.relationshipsSet[h].objectIdField,fields:a.fields,features:[],fieldAliases:null},r;for(r in b){var d=b[r];d.features&&0<d.features.length&&(F.features=F.features.concat(d.features))}0<F.features.length?(this.createRelationTable(h,a,F),this.exportButton&&this.exportButton.set("disabled",
!1)):(b=c.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e"),c.empty(this.relationTabPagesSet[h].content),e.place(b,this.relationTabPagesSet[h].content));v.opened=!0;this.refreshGridHeight();this.showRelationLoading(h,!1)}),l.hitch(this,function(a){console.error(a);a=c.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e");c.empty(this.relationTabPagesSet[h].content);e.place(a,this.relationTabPagesSet[h].content);this.showRelationLoading(h,!1)}))}),l.hitch(this,function(a){console.error(a);
this.showRelationLoading(h,!1)})))}else(a=this.relationGridsSet[h])&&a.store&&a.store.data&&this.exportButton?this.exportButton.set("disabled",!1):this.exportButton&&this.exportButton.set("disabled",!0),this.showRelationLoading(h,!1)},createRelationTable:function(h,b,r){var v=z.map(r.features,l.hitch(this,function(a){return a.attributes})),f=this._generateMemoryStore(v,r.displayFieldName);b=this._generateColumnsFromFields(r.fields,b.typeIdField,b.types);this.relationGridsSet[h]?(this.relationGridsSet[h].set("store",
f),this.relationGridsSet[h].refresh()):(f={columns:b,store:f},f=new (g([d,t,x,a]))(f,e.create("div")),e.place(f.domNode,this.relationTabPagesSet[h].content),f.startup(),f.__pk=r.displayFieldName,f.__outFields=r.fields,this.relationGridsSet[h]=f,this.own(y(f,"click",l.hitch(this,this.onRelationGridRowClick))),r=q.get(this.domNode,"height"),q.set(this.relationGridsSet[h].domNode,"height",r-this.noGridHeight+"px"));this.relationGridFootersSet[h]?c.empty(this.relationGridFootersSet[h]):this.relationGridFootersSet[h]=
c.create("div",null,this.relationTabPagesSet[h].content);v=c.create("div",{"class":"dgrid-status self-footer",innerHTML:v.length+"\x26nbsp;"+this.nls.features+"\x26nbsp;"},this.relationGridFootersSet[h]);this.relationSelectedRowsLabelDivsSet[h]=c.create("div",{"class":"dgrid-status self-footer",innerHTML:"0\x26nbsp;"+this.nls.selected+"\x26nbsp;"},v,"after")},tabChanged:function(){this.exportButton&&this.exportButton.set("disabled",!0);if(this.tabContainer&&this.tabContainer.selectedChildWidget){var a=
this.tabContainer.selectedChildWidget.params.layerType;if(a===this._layerTypes.FEATURELAYER)a=this.tabContainer.selectedChildWidget.params.id,this.currentRelationshipKey=null,this._startQueryOnLayerTab(a);else if(a===this._layerTypes.RELATIONSHIPTABLE){var b=this.tabContainer.selectedChildWidget.params,a=b.id,r=b.oids,b=b.layersIndex;this.currentRelationshipKey=a;this.relationshipsSet[a]&&this._startQueryOnRelationTab(a,r,b)}this.onMapResize()}this.resetButtonStatus()},checkMapInteractiveFeature:function(){var a=
this.configLayerInfos[this.layersIndex];if(a){a.isShowInMap()?c.setStyle(this.zoomButton.domNode,"display","inline-block"):c.setStyle(this.zoomButton.domNode,"display","none");for(var a=0,b=this.configLayerInfos.length;a<b;a++)this.graphicsLayers[a]&&this.configLayerInfos[a].isShowInMap()?this.graphicsLayers[a].show():this.graphicsLayers[a]&&this.graphicsLayers[a].hide()}},resetButtonStatus:function(){if(this.tabContainer&&this.tabContainer.selectedChildWidget){var a=this.tabContainer.selectedChildWidget.params.layerType;
a===this._layerTypes.FEATURELAYER?((a=this.getSelectedRows())&&a.length?(this.showSelectedRecords.set("disabled",!1),this.zoomButton.set("disabled",!1),a=this.layers[this.layersIndex],a.relationships&&0<a.relationships.length&&this.showRelatedRecords.set("disabled",!1)):(this.showSelectedRecords.set("disabled",!0),this.zoomButton.set("disabled",!0),this.showRelatedRecords.set("disabled",!0)),this.config.layerInfos&&0===this.config.layerInfos.length?(this.selectionMenu.set("disabled",!0),this.refreshButton.set("disabled",
!0),this.matchingCheckBox.set("disabled",!0)):(this.selectionMenu.set("disabled",!1),this.refreshButton.set("disabled",!1),this.matchingCheckBox.set("disabled",!1)),this.setSelectedNumber()):a===this._layerTypes.RELATIONSHIPTABLE&&(this.showRelatedRecords.set("disabled",!0),this.matchingCheckBox.set("disabled",!0),this.zoomButton.set("disabled",!0))}},createTable:function(h,b,r,v){if(this.grids[r])this.grids[r].set("store",b),this.grids[r].refresh();else{this.config.layerInfos[r].loaded=!0;var f=
{};f.columns=h;f.store=b;f.keepScrollPosition=!0;f.pagingDelay=1E3;h=new (g([d,t,x,a]))(f,e.create("div"));e.place(h.domNode,this.layerTabPages[r].content);h.startup();h._clickShowSelectedRecords=!1;h._clickRefreshButton=!1;h._clickFilterByExtent=!1;this.grids[r]=h;this.own(y(h,"click",l.hitch(this,this.onLayerGridRowClick)));this.own(y(h,"dblclick",l.hitch(this,function(){if(this.configLayerInfos[this.layersIndex].isShowInMap())this.onZoomButton()})));this.own(y(h,"dgrid-select",l.hitch(this,this._onLayerDgridSelect)));
this.own(y(h,"dgrid-deselect",l.hitch(this,this._onLayerDgridDeselect)));this.own(y(h,"dgrid-refresh-complete",l.hitch(this,this._onLayerDgridRefreshComplete)));h=q.get(this.domNode,"height");q.set(this.grids[r].domNode,"height",h-this.noGridHeight+"px");this.refreshGridHeight();if(1===this.grids.length)this.onMapResize()}this.gridFooters[r]?c.empty(this.gridFooters[r]):this.gridFooters[r]=c.create("div",null,this.layerTabPages[r].content);v=c.create("div",{"class":"dgrid-status self-footer",innerHTML:v+
"\x26nbsp;"+this.nls.features+"\x26nbsp;"},this.gridFooters[r]);this.selectedRowsLabelDivs[r]=c.create("div",{"class":"dgrid-status self-footer",innerHTML:"0\x26nbsp;"+this.nls.selected+"\x26nbsp;"},v,"after");this.showLoading(r,!1)},showRefreshing:function(a){this.loading&&(a?this.loading.show():this.loading.hide())},showLoading:function(a,b){this.loadings[a]&&(b?this.loadings[a].show():this.loadings[a].hide())},showRelationLoading:function(a,b){this.relationLoadingSet[a]&&(b?this.relationLoadingSet[a].show():
this.relationLoadingSet[a].hide())},_doQuery:function(a,b){var r=this.getSelectedRows(),c=this.layers[a].objectIdField,d=this.layers[a].url&&this.config.layerInfos[a].layer.url,e="esri.layers.CSVLayer"===this.layers[a].declaredClass;d&&!e?this._queryToServer(a,b,c,r):(!d||e)&&this._queryOnClient(a,b,c,r)},_queryToServer:function(a,b,r,c){this._getFeatureCount(a,b).then(l.hitch(this,function(d){var e=this.layers[a],e=Z.isDefined(e.maxRecordCount)?e.maxRecordCount:1E3;this._batchCount=Math.min(e,this._defaultBatchCount);
d<e?this._queryFeatureLayer(a,b,r,c,d,!1):this._getFeatureIds(a,b).then(l.hitch(this,function(b){this.layers[a]._objectIds=b;b=this._getOutFieldsFromLayerInfos(a,r);this.queryExecute(c,a,b,d,!0,{fields:this.layers[a].fields})}))}))},_queryFeatureLayer:function(a,b,r,c,d,e){var f=new N(this.config.layerInfos[a].layer.url),g=new D;g.where=this._getLayerFilterExpression(this.layers[a]);r=this._getOutFieldsFromLayerInfos(a,r);if(0<r.length){var k=z.map(r,function(a){return a.name});g.outFields=k}else g.outFields=
["*"];b&&(g.geometry=b,g.spatialRelationship=D.SPATIAL_REL_INTERSECTS,this.config.layerInfos[a].opened=!1);g.outSpatialReference={wkid:this.map.spatialReference.wkid};this.config.layerInfos[a].extent=b;g.returnGeometry=!1;f.execute(g,l.hitch(this,this.queryExecute,c,a,r,d,e),l.hitch(this,this.errorQueryTask,a))},_getOutFieldsFromLayerInfos:function(a,b){var r=this.config.layerInfos[a].layer.fields,c=[];r&&z.forEach(r,l.hitch(this,function(a){void 0===a.show&&(a.show=!0);a.name===b&&(a._pk=!0);(a.show||
a._pk)&&c.push(a)}));return c},_getFeatureCount:function(a,b){var r=new B,c=new D;c.returnGeometry=!1;c.where=this._getLayerFilterExpression(this.layers[a]);b&&(c.geometry=b);this.layers[a].queryCount(c).then(l.hitch(this,function(a){r.resolve(a)}),l.hitch(this,function(a){console.error(a);console.log("Could not get feature count. Defaulting to 2000 features");r.resolve(this._defaultFeatureCount)}));return r},_getFeatureIds:function(a,b){var r=new B,c=new D;c.returnGeometry=!1;c.returnIdsOnly=!0;
c.where=this._getLayerFilterExpression(this.layers[a]);b&&(c.geometry=b);this.layers[a].queryIds(c).then(l.hitch(this,function(a){r.resolve(a)}),l.hitch(this,function(a){console.error(a);console.log("Could not get feature Ids");r.resolve([])}));return r},_queryOnClient:function(a,b,r,c){var d={};d.features=this.layers[a].graphics;var e=this.layers[a].fields,f=this.config.layerInfos[a].layer.fields;d.fields=f?z.filter(f,l.hitch(this,function(a){void 0===a.show&&(a.show=!0);a.name===r&&(a._pk=!0);for(var b=
0,h=e.length;b<h;b++)e[b].name===a.name&&(a.type=e[b].type);return a.show||a._pk})):z.filter(e,l.hitch(this,function(a){void 0===a.show&&(a.show=!0);a.name===r&&(a._pk=!0);return a.show||a._pk}));d.selectionRows=c;if(b&&M.defaults.geometryService){for(var f=[],g=d.features.length,k=0;k<g;k++)f.push(d.features[k].geometry);g=new Q;g.geometries1=f;g.geometries2=[b];g.relation=Q.SPATIAL_REL_INTERSECTION;M.defaults.geometryService.relation(g,l.hitch(this,function(b,r){for(var F=r.length,d=[],e=0;e<F;e++)d.push(b.features[r[e].geometry1Index]);
b.features=d;this.queryExecute(c,a,b.fields,b.features.length,!1,b)},d),l.hitch(this,this.errorGeometryServices,a))}else this.queryExecute(c,a,d.fields,d.features.length,!1,d)},startQuery:function(a,b){this.config.layerInfos&&0!==this.config.layerInfos.length&&(this.showLoading(a,!0),b&&b.spatialReference&&b.spatialReference.isWebMercator()?da.normalizeCentralMeridian([b],null,l.hitch(this,function(b){this._doQuery(a,b[0])}),l.hitch(this,function(b){this.popupMessage(a,b.message||b)})):this._doQuery(a,
b))},errorGeometryServices:function(a,b){this.popupMessage(a,b.message)},errorQueryTask:function(a,b){this.popupMessage(a,b.message)},onExtentChange:function(a){this.matchingMap&&this.startQuery(this.layersIndex,a.extent)},_processExecuteFields:function(a,b){if(a&&0<a.length){var r=[];if(!b.length)return a;for(var c=0,d=b.length;c<d;c++)for(var e=0;e<a.length;e++)b[c].name===a[e].name&&(a[e]=l.mixin(a[e],b[c]),r.push(a[e]));return r}return b},_generateColumnsFromFields:function(a,b,c,d){var e={};
z.forEach(a,l.hitch(this,function(f,g){var k="field"+g,m=!!f.domain,n="esriFieldTypeDate"===f.type,p=b&&f.name===b;e[k]={label:f.alias||f.name,className:k,hidden:!f.show&&void 0!==f.show,unhidable:!f.show&&void 0!==f.show&&f._pk,field:f.name};e[k].sortable=d?!1:!0;if("esriFieldTypeString"===a[g].type)e[k].formatter=l.hitch(this,this.urlFormatter);else if("esriFieldTypeDate"===a[g].type)e[k].formatter=l.hitch(this,this.dateFormatter);else if("esriFieldTypeDouble"===a[g].type||"esriFieldTypeSingle"===
a[g].type||"esriFieldTypeInteger"===a[g].type||"esriFieldTypeSmallInteger"===a[g].type)e[k].formatter=l.hitch(this,this.numberFormatter);m?e[k].get=l.hitch(this,function(a,b){return this.getCodeValue(a.domain,b[a.name])},f):!m&&(!n&&!p)&&(e[k].get=l.hitch(this,function(a,b,h,c){var r=null;b&&h&&0<h.length&&(h=z.filter(h,l.hitch(this,function(a){return a.name===c[b]})))&&(h.domains&&h.domains[a.name]&&h.domains[a.name].codedValues)&&(r=this.getCodeValue(h.domains[a.name],c[a.name]));return(a=null!==
r?r:c[a.name])||isFinite(a)?a:""},f,b,c))}));return e},_generateCacheStore:function(a,b){var c=new ka({layer:a,objectIds:a._objectIds||null,totalCount:b,batchCount:this._batchCount,where:a&&a.getDefinitionExpression()||"1\x3d1",orderByFields:""}),d=new p;return new u(c,d,{})},_generateMemoryStore:function(a,b){return new w(new p({data:a||[],idProperty:b}))},queryExecute:function(a,b,c,d,e,f){var g=[],k=null,m={};if(this.domNode){this.showLoading(b,!0);f.fields=this._processExecuteFields(f.fields,
c);e?k=this._generateCacheStore(this.layers[b],d):(z.map(f.features,l.hitch(this,function(a){var h="",c;for(c in a.attributes)h=a.attributes[c],c===this.layers[b].typeIdField&&this.layers[b].types&&(h=this.getTypeName(h,this.layers[b].types),a.attributes[c]=h);g.push(a.attributes)})),k=this._generateMemoryStore(g,this.layers[b].objectIdField));!this.config.layerInfos[b].loaded&&f.fields&&(m=this._generateColumnsFromFields(f.fields,this.layers[b].typeIdField,this.layers[b].types,e));this.createTable(m,
k,b,d);if(a&&a.length){for(var n in a)this.grids[b].select(a[n]);this.selections[b]=a;this.resetButtonStatus();this.setSelectedNumber()}this.exportButton&&this.exportButton.set("disabled",!1)}},getCodeValue:function(a,b){for(var c=0,d=a.codedValues.length;c<d;c++){var e=a.codedValues[c];if(b===e.code)return e.name}return null},urlFormatter:function(a){if(a){var b=a.indexOf("http:");-1===b&&(b=a.indexOf("https:"));if(-1<b&&-1===a.indexOf("href\x3d")){var c=a.indexOf(" ",b);-1===c&&(c=a.length);var d=
a.substring(b,c);a=a.substring(0,b)+'\x3cA href\x3d"'+d+'" target\x3d"_blank"\x3e'+d+"\x3c/A\x3e"+a.substring(c,a.length)}}return a||""},dateFormatter:function(a){a&&(a=n.localizeDate(new Date(a),{fullYear:!0}));return a||""},numberFormatter:function(a){if("number"===typeof a){var b=(a.toString().split(".")[1]||"").length;a=n.localizeNumber(a,{places:b});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(a||"")+"\x3c/span\x3e"}return a},getTypeName:function(a,b){for(var c=b.length,d=0;d<c;d++)if(a===
b[d].id)return b[d].name;return""},getFieldType:function(a,b){if(b&&0<b.length)for(var c=b.length,d=0;d<c;d++)if(a===b[d].name)return b[d].type;return""},onLayerGridRowClick:function(a){var b=[],c=this.grids[this.layersIndex].selection,d;for(d in c)c[d]&&b.push(d);b.length?(this.showSelectedRecords.set("disabled",!1),this.zoomButton.set("disabled",!1),c=this.layers[this.layersIndex],c.relationships&&0<c.relationships.length?this.showRelatedRecords.set("disabled",!1):this.showRelatedRecords.set("disabled",
!0),this.layers[this.layersIndex].url?this._queryFeaturesByIds(b,"rowclick"):a&&!a.type&&a.length?this.selectFeatures("zoom",this.getGraphicsFromLocalFeatureLayer(this.layersIndex,b)):this.selectFeatures("rowclick",this.getGraphicsFromLocalFeatureLayer(this.layersIndex,b))):(this.zoomButton.set("disabled",!0),this.showSelectedRecords.set("disabled",!0),this.showRelatedRecords.set("disabled",!0),this.graphicsLayers[this.layersIndex].clear())},onRelationGridRowClick:function(){var a=[],b=this.relationGridsSet[this.currentRelationshipKey].selection,
c;for(c in b)b[c]&&a.push(c);this.resetButtonStatus();this.setSelectedNumber()},errorSelectFeatures:function(a,b){this.popupMessage(a,b.message)},getGraphicsFromLocalFeatureLayer:function(a,b){for(var c=[],d,e=b.length,f=this.layers[a].graphics.length,g=this.layers[a].objectIdField,k=0;k<e;k++)for(var l=0;l<f;l++)if(d=this.layers[a].graphics[l].attributes[g]+"",d===b[k]){c.push(this.layers[a].graphics[l]);break}return c},getExtent:function(a){var b=new B,c,d,e=a.length;if(1===e&&a[0].geometry&&"point"===
a[0].geometry.type)c=a[0].geometry;else{if(1===e&&!a[0].geometry)return b.reject(Error("AttributeTable.getExtent:: extent was not projected.")),b;for(var f=0;f<e;f++)a[f].geometry?"point"===a[f].geometry.type?(d||(d=new T(a[f].geometry.spatialReference)),d.addPoint(a[f].geometry),f===e-1&&(c=d.getExtent())):c=c?c.union(a[f].geometry.getExtent()):a[f].geometry.getExtent():console.error("unable to get geometry of the reocord: ",a[f])}if(!c||!c.spatialReference)return b.reject(Error("AttributeTable.getExtent:: extent was not projected.")),
b;a=this.map.spatialReference;c.spatialReference.wkid===a.wkid?b.resolve(c):(d=new G,d.geometries=[c],d.outSR=a,M.defaults.geometryService.project(d,l.hitch(this,function(a){a&&a.length?b.resolve(a[0]):b.reject(Error("AttributeTable.getExtent:: extent was not projected."))}),l.hitch(this,function(a){a||(a=Error("AttributeTable.getExtent:: extent was not projected."));b.reject(a)})));return b},addGraphics:function(a){var b,c,d=a.length;this.graphicsLayers[this.layersIndex].clear();for(var e=new U(U.STYLE_SOLID,
new W([0,255,255]),2),f=0;f<d;f++)c=null,a[f].geometry?(a[f].geometry.spatialReference.wkid!==this.map.spatialReference.wkid&&console.warn("unable to draw graphic result in different wkid from map"),"point"===a[f].geometry.type?(c=new H(a[f].geometry.toJson()),b=l.clone(this.map.infoWindow.markerSymbol)):"multipoint"===a[f].geometry.type?(c=new T(a[f].geometry.toJson()),b=l.clone(this.map.infoWindow.markerSymbol)):"polyline"===a[f].geometry.type?(c=new ba(a[f].geometry.toJson()),b=e):"polygon"===
a[f].geometry.type&&(c=new ca(a[f].geometry.toJson()),b=new V(V.STYLE_SOLID,e,new W([255,255,255,0.25]))),c=new C(c,b,a[f].attributes,a[f].infoTemplate),this.graphicsLayers[this.layersIndex].add(c)):console.error("unable to get geometry of the reocord: ",a[f])},setSelectedNumber:function(){if(this.tabContainer&&this.tabContainer.selectedChildWidget){var a=this.tabContainer.selectedChildWidget.params.layerType;if(a===this._layerTypes.FEATURELAYER){if(this.selectedRowsLabelDivs&&this.selectedRowsLabelDivs[this.layersIndex]&&
this.layersIndex<this.grids.length&&this.grids[this.layersIndex]){var b=this.getSelectedRows();this.selectedRowsLabelDivs[this.layersIndex].innerHTML="\x26nbsp;\x26nbsp;"+b.length+" "+this.nls.selected+"\x26nbsp;\x26nbsp;"}}else if(a===this._layerTypes.RELATIONSHIPTABLE&&(a=this.relationSelectedRowsLabelDivsSet[this.currentRelationshipKey])){var c=this.relationGridsSet[this.currentRelationshipKey].selection,d=[];if(c)for(b in c)c[b]&&d.push(b);a.innerHTML="\x26nbsp;\x26nbsp;"+d.length+" "+this.nls.selected+
"\x26nbsp;\x26nbsp;"}}},_getLayerFilterExpression:function(a){var b=a.getDefinitionExpression();return b?b:(b=(a=this._getLayerInfoById(a.id))&&a.originOperLayer&&a.originOperLayer.layerDefinition&&a.originOperLayer.layerDefinition.definitionExpression)||"1\x3d1"},_queryFeaturesByIds:function(a,b){var c=new D;c.objectIds=a;c.returnGeometry=!0;c.outSpatialReference=this.map.spatialReference;c.outFields=["*"];var d=this.layers[this.layersIndex],e="esri.layers.CSVLayer"===d.declaredClass;d.url&&!e?(new N(d.url)).execute(c,
l.hitch(this,function(a){this.selectFeatures(b,a.features)}),l.hitch(this,this.errorSelectFeatures,this.layersIndex)):this.layers[this.layersIndex].selectFeatures(c,R.SELECTION_NEW,l.hitch(this,this.selectFeatures,b),l.hitch(this,this.errorSelectFeatures,this.layersIndex))},selectFeatures:function(a,c){if(c&&0<c.length)"mapclick"===a?(this.addGraphics(c,!0),this.config.layerInfos[this.layersIndex].isDynamicLayer&&this.highlightRow(c[0].attributes[this.grids[this.layersIndex].store.idProperty]+"")):
"rowclick"===a||"selectall"===a?this.addGraphics(c,!0):"zoom"===a&&this.getExtent(c).then(l.hitch(this,function(a){a&&("point"===a.type?this.map.centerAndZoom(a,15):this.map.setExtent(a.expand(1.1)))}),l.hitch(this,function(a){console.error(a)})),this.setSelectedNumber();else var d=new b({message:this.nls.dataNotAvailable,buttons:[{label:this.nls.ok,onClick:l.hitch(this,function(){d.close()})}]})},_onDragStart:function(a){this.moveMode=!0;this.moveY=a.clientY;this.previousDomHeight=q.get(this.domNode,
"height");this.previousArrowTop=q.get(this.arrowDiv,"top");q.set(this.arrowDiv,"background-color","gray");q.set(this.moveMaskDiv,"display","");this._dragingHandlers=this._dragingHandlers.concat([y(this.ownerDocument,"dragstart",function(a){a.stopPropagation();a.preventDefault()}),y(this.ownerDocumentBody,"selectstart",function(a){a.stopPropagation();a.preventDefault()})])},_onDraging:function(a){this.moveMode&&this._changeHeight(this.moveY-a.clientY+this.previousDomHeight)},_onDragEnd:function(){this.moveMode=
!1;q.set(this.arrowDiv,"background-color","");q.set(this.moveMaskDiv,"display","none");for(var a=this._dragingHandlers.pop();a;)a.remove(),a=this._dragingHandlers.pop()},refreshGridHeight:function(){var a=P(".dijitTabPaneWrapper");a&&a.length&&q.set(a[0],"height","100%")},setInitialPosition:function(){var a;this.position.height?a=this.position.height:(a=document.body.clientHeight,a/=3);this.bottomPosition=this.position.bottom?this.position.bottom:0;this.normalHeight=a;q.set(this.domNode,"top","auto");
q.set(this.domNode,"left","0px");q.set(this.domNode,"right","0px");q.set(this.domNode,"bottom",this.bottomPosition+"px");q.set(this.domNode,"position","absolute")},initDiv:function(){this.AttributeTableDiv=e.create("div",{},this.domNode);A.add(this.AttributeTableDiv,"jimu-widget-attributetable-main");var a=e.create("div");this.toolbarDiv=a;var b=new ga({},e.create("div")),d=new ha;this.showSelectedRecords=new K({label:this.nls.showSelectedRecords,iconClass:"esriAttributeTableSelectPageImage",onClick:l.hitch(this,
this._showSelectedRecords)});d.addChild(this.showSelectedRecords);this.showRelatedRecords=new K({label:this.nls.showRelatedRecords,iconClass:"esriAttributeTableSelectAllImage",onClick:l.hitch(this,this._showRelatedRecords)});d.addChild(this.showRelatedRecords);this.matchingCheckBox=new ia({checked:!1,label:this.nls.filterByExtent,onChange:l.hitch(this,function(a){(this.matchingMap=a)?(this.grids[this.layersIndex]&&(this.grids[this.layersIndex]._clickFilterByExtent=!0),this.startQuery(this.layersIndex,
this.map.extent)):(this.grids[this.layersIndex]&&(this.grids[this.layersIndex]._clickFilterByExtent=!1),this.startQuery(this.layersIndex))})});d.addChild(this.matchingCheckBox);var g=new K({label:this.nls.columns,iconClass:"esriAttributeTableColumnsImage",onClick:l.hitch(this,this.toggleColumns)});d.addChild(g);this.config.hideExportButton||(this.exportButton=new K({label:this.nls.exportFiles,showLabel:!0,iconClass:"esriAttributeTableExportImage",onClick:l.hitch(this,this.onExportButton)}),d.addChild(this.exportButton));
this.selectionMenu=new ja({label:this.nls.options,iconClass:"esriAttributeTableOptionsImage",dropDown:d});b.addChild(this.selectionMenu);this.zoomButton=new J({label:this.nls.zoomto,iconClass:"esriAttributeTableZoomImage",onClick:l.hitch(this,this.onZoomButton)});b.addChild(this.zoomButton);d=new J({label:this.nls.clearSelection,iconClass:"esriAttributeTableClearImage",onClick:l.hitch(this,this._clearSelection,!1)});b.addChild(d);this.refreshButton=new J({label:this.nls.refresh,showLabel:!0,iconClass:"esriAttributeTableRefreshImage",
onClick:l.hitch(this,this.onClickRefreshButton)});b.addChild(this.refreshButton);this.closeButton=new J({title:this.nls.closeMessage,iconClass:"esriAttributeTableCloseImage",onClick:l.hitch(this,this._closeTable)});c.addClass(this.closeButton.domNode,"jimu-float-trailing");b.addChild(this.closeButton);e.place(b.domNode,a);b=e.create("div");this.tableDiv=e.create("div");e.place(this.tableDiv,b);e.place(a,this.AttributeTableDiv);e.place(b,this.AttributeTableDiv);this.toolbarHeight=a=q.get(a,"height");
this.noGridHeight=50+a+15;this.tabContainer=new f({style:"width: 100%;"},b);c.setStyle(this.tabContainer.domNode,"height",this.normalHeight-a+"px");a=this.config.layerInfos.length;for(b=0;b<a;b++)this.config.layerInfos[b].show&&(d=l.clone(this.config.layerInfos[b]),g=e.create("div"),d.id=d.id,d.title=d.name,d.content=g,d.layerType=this._layerTypes.FEATURELAYER,d.style="height: 100%; width: 100%; overflow: visible;",d=new k(d),this.layerTabPages[b]=d,this.tabContainer.addChild(d),this.loadings[b]||
(this.loadings[b]=new L),this.loadings[b].placeAt(d),this.loadings[b].show());this.tabContainer.startup();n.setVerticalCenter(this.tabContainer.domNode);this.tabChanged();this.own(ea.after(this.tabContainer,"selectChild",l.hitch(this,this.tabChanged)))},getLayerInfoLabel:function(a){return a.name||a.title},getLayerInfoId:function(a){return a&&a.id||""},toggleColumns:function(){-1<this.layersIndex&&this.grids[this.layersIndex]&&this.grids[this.layersIndex]._toggleColumnHiderMenu()},onClickRefreshButton:function(){if(this.tabContainer&&
this.tabContainer.selectedChildWidget){var a=this.tabContainer.selectedChildWidget.params.layerType;a===this._layerTypes.FEATURELAYER?-1<this.layersIndex&&(this.grids[this.layersIndex]&&this.grids[this.layersIndex].clearSelection(),this.graphicsLayers[this.layersIndex]&&this.graphicsLayers[this.layersIndex].clear(),this.setSelectedNumber(),this.config.layerInfos[this.layersIndex]&&(this.config.layerInfos[this.layersIndex].loaded=!1,this.startQuery(this.layersIndex,this.config.layerInfos[this.layersIndex].extent))):
a===this._layerTypes.RELATIONSHIPTABLE&&this.currentRelationshipKey&&(this.relationGridsSet[this.currentRelationshipKey]&&this.relationGridsSet[this.currentRelationshipKey].clearSelection(),this.setSelectedNumber(),this.relationshipsSet[this.currentRelationshipKey]&&(this.relationshipsSet[this.currentRelationshipKey].opened=!1,this._startQueryOnRelationTab(this.currentRelationshipKey)))}},addNewLayerTab:function(a){a=this._getLayerInfoById(a.layer.id)||this._getLayerInfoByName(a.layer.name);var b=
this.getLayerInfoId(a);if(b=this.getExistLayerTabPage(b))this.onOpen(),this.tabContainer.selectChild(b),this.tabChanged();else{b=E.getConfigInfoFromLayerInfo(a);this.config.layerInfos.push({name:b.name,layer:{url:b.layer.url,fields:b.layer.fields}});this.configLayerInfos.push(a);b=new S;this.graphicsLayers.push(b);this.map.addLayer(b);this.onOpen();var c=e.create("div"),b={};b.name=this.getLayerInfoLabel(a);b.id=this.getLayerInfoId(a);b.content=c;b.closable=!0;b.layerType=this._layerTypes.FEATURELAYER;
b.style="height: 100%; width: 100%; overflow: visible";a=new k(b);this.layerTabPages.push(a);c=new L;c.placeAt(a);this.loadings.push(c);a.set("title",b.name);this.own(y(a,"close",l.hitch(this,this.layerTabPageClose,b.id)));this.tabContainer.addChild(a);this.tabContainer.selectChild(a)}},addNewRelationTab:function(a,b,c){var d=this.getExistRelationTabPage(b._relKey);if(d)d.onClose();var f=e.create("div"),d={};d.oids=a;d.name=b._unionName;d.id=b._relKey;d.content=f;d.layersIndex=c;d.closable=!0;d.layerType=
this._layerTypes.RELATIONSHIPTABLE;d.style="height: 100%; width: 100%; overflow: visible";a=new k(d);this.relationTabPagesSet[b._relKey]=a;c=new L;c.placeAt(a);this.relationLoadingSet[b._relKey]=c;a.set("title",d.name);this.own(y(a,"close",l.hitch(this,this.relationTabPageClose,d.id)));this.tabContainer.addChild(a);this.tabContainer.selectChild(a)},onReceiveData:function(a,b,c){c&&"AttributeTable"===c.target&&(0===this.currentHeight?this._openTable().then(l.hitch(this,this._addLayerToTable,c)):E.readConfigLayerInfosFromMap(this.map).then(l.hitch(this,
function(a){this._allLayerInfos=a;this._processDelayedLayerInfos();this._addLayerToTable(c)})))},_addLayerToTable:function(a){var c=null;a.layer.getLayerObject().then(l.hitch(this,function(b){b?(b.id=a.layer.id,b.loaded?this.addNewLayerTab({layer:b}):this.own(y(b,"load",l.hitch(this,this.addNewLayerTab)))):a.url&&(c=new R(a.url),this.own(y(c,"load",l.hitch(this,this.addNewLayerTab))))}),l.hitch(this,function(a){new b({message:a.message||a})}))},getExistLayerTabPage:function(a){for(var b=this.layerTabPages.length,
c=0;c<b;c++)if(this.layerTabPages[c].get("id")===a)return this.layerTabPages[c];return null},getExistRelationTabPage:function(a){return this.relationTabPagesSet[a]},layerTabPageClose:function(a,b){for(var c=this.layerTabPages.length,d=0;d<c;d++)if(this.layerTabPages[d].id===a){this.loadings&&this.loadings[d]&&(this.loadings[d].destroy(),this.loadings.splice(d,1));!0===b&&this.tabContainer.removeChild(this.layerTabPages[d]);this.grids&&this.grids[d]&&(this.grids[d].destroy(),this.grids.splice(d,1));
this.layerTabPages&&this.layerTabPages[d]&&(this.layerTabPages[d].destroyDescendants(),this.layerTabPages.splice(d,1));this.config&&(this.config.layerInfos&&this.config.layerInfos[d])&&(this.config.layerInfos.splice(d,1),this.configLayerInfos.splice(d,1));this.layers&&this.layers[d]&&(this.layers.splice(d,1),this._allLayerInfos.splice(d,1));this.graphicsLayers&&this.graphicsLayers[d]&&(this.map.removeLayer(this.graphicsLayers[d]),this.graphicsLayers.splice(d,1));this.selectedRowsLabelDivs&&this.selectedRowsLabelDivs[d]&&
this.selectedRowsLabelDivs.splice(d,1);this.gridFooters&&this.gridFooters[d]&&this.gridFooters.splice(d,1);if(1===c){this.layersIndex=-1;this.onClose();return}d<this.layersIndex?this.layersIndex--:d===this.layersIndex&&(1<c?(this.layersIndex=c-2,this.tabContainer.selectChild(this.layerTabPages[this.layersIndex]),this.tabChanged()):this.layersIndex=0);break}setTimeout(l.hitch(this,function(){this.refreshGridHeight()}),10)},relationTabPageClose:function(a){var b=this.getExistRelationTabPage(a);b&&(this.tabContainer.removeChild(b),
this.relationLoadingSet[a]&&(this.relationLoadingSet[a].destroy(),this.relationLoadingSet[a]=null),this.relationGridsSet[a]&&(this.relationGridsSet[a].destroy(),this.relationGridsSet[a]=null),b&&(b.destroyDescendants(),b.destroy(),this.relationTabPagesSet[a]=null),this.relationGridFootersSet[a]&&(this.relationGridFootersSet[a]=null),this.relationSelectedRowsLabelDivsSet[a]&&(this.relationSelectedRowsLabelDivsSet[a]=null),this.currentRelationshipKey=null,this.relationshipsSet[a].opened=!1,setTimeout(l.hitch(this,
function(){this.refreshGridHeight()}),10))},_clearSelection:function(){if(this.tabContainer&&this.tabContainer.selectedChildWidget){var a=this.tabContainer.selectedChildWidget.params.layerType;a===this._layerTypes.FEATURELAYER?(this.grids[this.layersIndex].clearSelection(),this.selections[this.layersIndex]=[],this.grids[this.layersIndex].set("query",{}),this.graphicsLayers[this.layersIndex].clear()):a===this._layerTypes.RELATIONSHIPTABLE&&(this.relationGridsSet[this.currentRelationshipKey].clearSelection(),
this.relationGridsSet[this.currentRelationshipKey].set("query",{}))}this.resetButtonStatus()},_showSelectedRecords:function(){var a=null,b=null;if(this.tabContainer&&this.tabContainer.selectedChildWidget){var c=this.tabContainer.selectedChildWidget.params.layerType;c===this._layerTypes.FEATURELAYER?(a=this.grids[this.layersIndex],b=this.layers[this.layersIndex].objectIdField,a._clickShowSelectedRecords=!0):c===this._layerTypes.RELATIONSHIPTABLE&&(a=this.relationGridsSet[this.currentRelationshipKey],
b=this.relationshipsSet[this.currentRelationshipKey].objectIdField)}var d=[],c=a.selection,e;for(e in c)c[e]&&(isFinite(e)?d.push(parseInt(e,10)):d.push(e));0<d.length&&a&&a.set("query",l.hitch(this,function(a){return"number"===typeof a&&-1<d.indexOf(a)||-1<d.indexOf(a[b])?!0:!1}))},_showRelatedRecords:function(){for(var a=this.getSelectedRows(),b=this.layers[this.layersIndex].relationships,c=0,d=b.length;c<d;c++)this.addNewRelationTab(a,b[c],this.layersIndex)},_processRelatedRecordsFromPopup:function(a,
b){var c=this._getLayerIndexById(a.id);-1<c&&this.configLayerInfos[c]&&this.configLayerInfos[c].getLayerObject().then(l.hitch(this,function(d){this.initSelectedLayer(d,c);this._collectRelationShips(d,a);d=d.relationships;for(var e=0,f=d.length;e<f;e++)this.addNewRelationTab(b,d[e],c)}))},showRelatedRecordsFromPopup:function(a,b){0===this.currentHeight?this._openTable().then(l.hitch(this,this._processRelatedRecordsFromPopup,a,b)):E.readConfigLayerInfosFromMap(this.map).then(l.hitch(this,function(c){this._allLayerInfos=
c;this._processDelayedLayerInfos();this._processRelatedRecordsFromPopup(a,b)}))},_onLayerDgridSelect:function(a){if(!this.grids[this.layersIndex]._clickShowSelectedRecords){var b=[];a=a.grid.selection;for(var c in a)a[c]&&(isFinite(c)?b.push(parseInt(c,10)):b.push(c));this.selections[this.layersIndex]=b}},_onLayerDgridDeselect:function(a){if(!this.grids[this.layersIndex]._clickShowSelectedRecords&&!this.grids[this.layersIndex]._clickFilterByExtent){var b=z.filter(this.selections[this.layersIndex],
l.hitch(this,function(b){return!z.some(a.rows,l.hitch(this,function(a){return b.toString()===a.id.toString()}))}));this.selections[this.layersIndex]=b}},_onLayerDgridRefreshComplete:function(a){if(a.grid._clickShowSelectedRecords){var b=this.selections[this.layersIndex];z.forEach(b,l.hitch(this,function(b){a.grid.select(b)}));a.grid._clickShowSelectedRecords=!1;this.layers[this.layersIndex].url?this._queryFeaturesByIds(b,"selectall"):this.selectFeatures("selectall",this.getGraphicsFromLocalFeatureLayer(this.layersIndex,
b))}},exportToCSV:function(){if(this.tabContainer&&this.tabContainer.selectedChildWidget){var a=this.tabContainer.selectedChildWidget.params;this.showRefreshing(!0);this._getExportData(a).then(l.hitch(this,function(b){this._createCSVStr(b.data,b.outFields,b.pk,b.types).then(l.hitch(this,function(b){this.download(a.name+".csv",b)}))})).always(l.hitch(this,function(){this.showRefreshing(!1)}))}},_getExportData:function(a){var b=new B,c=a.layerType,d=null,e=null,f=null,g=this.getSelectedRowsData();if(c===
this._layerTypes.FEATURELAYER){if(!this.config.layerInfos||0===this.config.layerInfos.length)return;d=this._getOutFieldsFromLayerInfos(this.layersIndex,this.layers[this.layersIndex].objectIdField);d=this._processExecuteFields(this.layers[this.layersIndex].fields,d);e=this.layers[this.layersIndex].objectIdField;f=this.layers[this.layersIndex].types}else if(c===this._layerTypes.RELATIONSHIPTABLE)var k=a.id,d=this.relationGridsSet[k].__outFields,e=this.relationGridsSet[k].__pk;g&&0<g.length?b.resolve({data:g,
outFields:d,pk:e,types:f}):c===this._layerTypes.FEATURELAYER?(a=this.grids[this.layersIndex].store,a instanceof p?(g=a.data,b.resolve({data:g,outFields:d,pk:e,types:f})):this._getExportDataFromServer(this.layersIndex,d).then(l.hitch(this,function(a){b.resolve({data:a,outFields:d,pk:e,types:f})}))):c===this._layerTypes.RELATIONSHIPTABLE?(g=this.relationGridsSet[a.id].store.data,b.resolve({data:g,outFields:d,pk:e,types:f})):b.resolve({data:[],outFields:d,pk:e,types:f});return b},_getExportDataFromServer:function(a,
b){var c=new B,d=this.layers[a],e=new N(d.url),f=new D;f.where=this._getLayerFilterExpression(d);0<b.length?(d=z.map(b,function(a){return a.name}),f.outFields=d):f.outFields=["*"];f.outSpatialReference={wkid:this.map.spatialReference.wkid};f.returnGeometry=!1;e.execute(f,l.hitch(this,function(a){a=z.map(a.features,function(a){return a.attributes});c.resolve(a)}),l.hitch(this,function(a){console.error(a);c.resolve([])}));return c},_createCSVStr:function(a,b,c,d){var e=new B,f="",g=0,k=0,l="",m="";
try{z.forEach(b,function(a){f=f+l+(a.alias||a.name);l=","});for(var f=f+"\r\n",g=a.length,k=b.length,n=0;n<g;n++){for(var l="",p=0;p<k;p++){var q=b[p],m=this._getExportValue(a[n][q.name],q,c,a[n][c],d);!m&&"number"!==typeof m&&(m="");m&&/[",]/g.test(m)&&(m='"'+m.replace(/(")/g,'""')+'"');f=f+l+m;l=","}f+="\r\n"}e.resolve(f)}catch(s){console.error(s),e.resolve("")}return e},_getExportValue:function(a,b,c,d,e){var f=!!b.domain,g="esriFieldTypeDate"===b.type,k=c&&b.name===c;return g?this.dateFormatter(a):
f?this.getCodeValue(b.domain,a):!f&&!g&&!k?(f=null,c&&e&&0<e.length&&(c=z.filter(e,l.hitch(this,function(a){return a.name===d})))&&(c.domains&&c.domains[b.name]&&c.domains[b.name].codedValues)&&(f=this.getCodeValue(c.domains[b.name],a)),null!==f?f:a):a},getSelectedRowsData:function(){if(this.tabContainer&&this.tabContainer.selectedChildWidget){var a=this.tabContainer.selectedChildWidget.params.layerType,b=null,c=null,b=null,b=[],d=null;if(a===this._layerTypes.FEATURELAYER){if(!this.grids.length||
!this.grids[this.layersIndex])return null;d=this.layers[this.layersIndex].objectIdField;b=this.grids[this.layersIndex].store;c=b._entityData||b.data;b=this.getSelectedRows();b=z.map(b,l.hitch(this,function(a){for(var b=0,e=c.length;b<e;b++)if(c[b]&&c[b][d]===a)return c[b];return[]}))}else if(a===this._layerTypes.RELATIONSHIPTABLE){a=this.tabContainer.selectedChildWidget.params.id;d=this.relationshipsSet[a].objectIdField;if(!this.relationGridsSet[a])return null;var b=this.relationGridsSet[a].store,
c=this.relationGridsSet[a].store.data,b=[],a=this.relationGridsSet[a].selection,e;for(e in a)a[e]&&(isFinite(e)?b.push(parseInt(e,10)):b.push(e));b=z.map(b,l.hitch(this,function(a){for(var b=0,e=c.length;b<e;b++)if(c[b][d]===a)return c[b];return{}}))}return b||[]}return null},getSelectedRows:function(){return this.selections[this.layersIndex]||[]},_isIE11:function(){var a=0,b=/MSIE (\d+\.\d+);/.test(navigator.userAgent),c=!!navigator.userAgent.match(/Trident\/7.0/),d=navigator.userAgent.indexOf("rv:11.0");
b&&(a=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(a=10);c&&-1!==d&&(a=11);return 11===a},download:function(a,b){if(Y("ie")||this._isIE11()){var c=window.top.open("about:blank","_blank");c.document.write(b);c.document.close();c.document.execCommand("SaveAs",!0,a);c.close()}else{c=e.create("a",{href:"data:attachment/csv;charset\x3dutf-8,"+encodeURIComponent(b),target:"_blank",download:a},this.domNode);if(Y("safari")){var d=document.createEvent("MouseEvents");d.initEvent("click",
!0,!0);c.dispatchEvent(d)}else c.click();e.destroy(c)}},onExportButton:function(){if(this.config.layerInfos&&0!==this.config.layerInfos.length)var a=new b({message:this.nls.exportMessage,titleLabel:this.nls.exportFiles,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:l.hitch(this,function(){this.exportToCSV();a.close()})},{label:this.nls.cancel,onClick:l.hitch(this,function(){a.close()})}]})},onZoomButton:function(){if(this.config.layerInfos&&0!==this.config.layerInfos.length){var a=[],b=this.grids[this.layersIndex].selection,
c;for(c in b)b[c]&&a.push(c);if(0!==a.length)if(this.layers[this.layersIndex].url)this._queryFeaturesByIds(a,"zoom");else this.onLayerGridRowClick(a)}},popupMessage:function(a,c){var d=new b({message:c,buttons:[{label:this.nls.ok,onClick:l.hitch(this,function(){d.close()})}]});this.showLoading(a,!1)}});m.inPanel=!1;m.hasUIFile=!1;return m});